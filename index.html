<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>2026 ë³´ë™ë³´ë™ ê°“ìƒì§€ì›ê¸ˆ</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=Gmarket+Sans:wght@300;500;700&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CSS VARIABLES â€” BLUE THEME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --primary: #1A56DB;
  --primary-light: #3F83F8;
  --primary-dark: #1e3a8a;
  --primary-darker: #172554;
  --accent: #F59E0B;
  --accent2: #FCD34D;
  --bg: #EFF6FF;
  --surface: #FFFFFF;
  --surface2: #F0F7FF;
  --text: #1E3A5F;
  --text-muted: #64748B;
  --border: #BFDBFE;
  --border-strong: #93C5FD;
  --danger: #EF4444;
  --success: #10B981;
  --warning: #F59E0B;
  --info: #3B82F6;
  --shadow: 0 4px 20px rgba(26,86,219,0.10);
  --shadow-lg: 0 8px 32px rgba(26,86,219,0.15);
  --radius: 16px;
  --radius-sm: 10px;
  --radius-xs: 6px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
html { scroll-behavior: smooth; }
body {
  font-family: 'Noto Sans KR', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  font-size: 15px;
  line-height: 1.5;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOADING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#loading-screen {
  position: fixed; inset: 0;
  background: linear-gradient(160deg, var(--primary-darker) 0%, var(--primary-dark) 60%, #1e40af 100%);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  z-index: 9999; transition: opacity 0.5s;
}
.loading-dice { font-size: 4rem; animation: bounce 1s infinite; }
@keyframes bounce { 0%,100%{ transform:translateY(0); } 50%{ transform:translateY(-12px); } }
.loading-title { font-family:'Gmarket Sans',sans-serif; font-size:1.6rem; color:var(--accent2); font-weight:700; margin:12px 0 4px; }
.loading-sub { color:#93C5FD; font-size:0.9rem; margin-bottom:28px; }
.spinner { width:36px; height:36px; border:3px solid rgba(255,255,255,0.2); border-top-color:var(--accent2); border-radius:50%; animation:spin 0.8s linear infinite; }
@keyframes spin { to { transform:rotate(360deg); } }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOGIN PAGE â€” MOBILE FIRST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#login-page {
  display: none; position: fixed; inset: 0; z-index: 200;
  background: linear-gradient(160deg, var(--primary-darker) 0%, var(--primary-dark) 55%, #1d4ed8 100%);
  overflow-y: auto;
}
.login-container {
  min-height: 100vh; display: flex; flex-direction: column; align-items: center;
  justify-content: center; padding: 24px 20px;
}
.login-hero { text-align: center; margin-bottom: 32px; }
.login-emoji { font-size: 4rem; display: block; margin-bottom: 12px; filter: drop-shadow(0 4px 12px rgba(0,0,0,0.3)); }
.login-title { font-family:'Gmarket Sans',sans-serif; font-size:1.7rem; color:#FCD34D; font-weight:700; line-height:1.3; margin-bottom:8px; }
.login-subtitle { color:#93C5FD; font-size:0.9rem; }
.login-card {
  background: #fff; border-radius: 24px; padding: 28px 24px; width: 100%; max-width: 400px;
  box-shadow: 0 24px 64px rgba(0,0,0,0.4);
}
.login-tab-row { display: flex; gap: 0; margin-bottom: 20px; background: var(--bg); border-radius: 10px; padding: 3px; }
.login-tab {
  flex: 1; text-align: center; padding: 9px 6px; border-radius: 8px; cursor: pointer;
  font-size: 0.85rem; font-weight: 500; color: var(--text-muted); transition: all 0.2s;
  border: none; background: transparent; font-family: inherit;
}
.login-tab.active { background: #fff; color: var(--primary); box-shadow: 0 2px 8px rgba(0,0,0,0.1); font-weight: 700; }

/* LOGIN PANEL */
.login-panel { display: none; }
.login-panel.active { display: block; }
.sso-btn {
  width: 100%; padding: 14px 16px; border: none; border-radius: 12px;
  font-family: inherit; font-size: 0.95rem; cursor: pointer;
  display: flex; align-items: center; justify-content: center; gap: 10px;
  margin-bottom: 10px; font-weight: 600; transition: all 0.2s; letter-spacing: -0.2px;
}
.sso-naver { background: #03C75A; color: #fff; }
.sso-naver:hover, .sso-naver:active { background: #02a84a; transform: translateY(-1px); }
.sso-google { background: #fff; color: #333; border: 2px solid #E5E7EB; }
.sso-google:hover, .sso-google:active { border-color: #9CA3AF; transform: translateY(-1px); }
.form-divider { display: flex; align-items: center; gap: 10px; margin: 16px 0; }
.form-divider::before, .form-divider::after { content:''; flex:1; height:1px; background:var(--border); }
.form-divider span { font-size:0.8rem; color:var(--text-muted); white-space:nowrap; }

/* SIGNUP PANEL */
.signup-panel-wrap { display: none; }
.signup-panel-wrap.active { display: block; }
.signup-intro { text-align: center; font-size: 0.88rem; color: var(--text-muted); margin-bottom: 16px; }

/* GENERAL INPUT FORM (login) */
.fl-input { position: relative; margin-bottom: 14px; }
.fl-input input {
  width: 100%; border: 1.5px solid var(--border); border-radius: 10px;
  padding: 14px 14px 6px; font-family: inherit; font-size: 0.95rem;
  background: var(--surface2); color: var(--text); outline: none; transition: border-color 0.2s;
}
.fl-input input:focus { border-color: var(--primary-light); background: #fff; }
.fl-input label {
  position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
  font-size: 0.9rem; color: var(--text-muted); pointer-events: none; transition: all 0.15s;
}
.fl-input input:focus ~ label,
.fl-input input:not(:placeholder-shown) ~ label {
  top: 8px; transform: none; font-size: 0.72rem; color: var(--primary);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   APP SHELL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#app { display: none; min-height: 100vh; flex-direction: column; }

/* â”€â”€ HEADER â”€â”€ */
.app-header {
  background: linear-gradient(135deg, var(--primary-darker) 0%, var(--primary-dark) 100%);
  padding: 0 16px; height: 56px; display: flex; align-items: center;
  justify-content: space-between; position: sticky; top: 0; z-index: 100;
  box-shadow: 0 2px 12px rgba(0,0,0,0.25);
}
.app-header-logo {
  font-family: 'Gmarket Sans', sans-serif; font-size: 1rem; color: #FCD34D;
  font-weight: 700; cursor: pointer; line-height: 1.2;
}
.app-header-logo small { display:block; color:#93C5FD; font-size:0.7rem; font-weight:300; }
.header-user { display: flex; align-items: center; gap: 8px; }
.header-chip { background: rgba(255,255,255,0.12); border-radius: 20px; padding: 5px 12px; font-size: 0.82rem; color: #E0F2FE; display: flex; align-items: center; gap: 6px; }
.credit-pill { background: var(--accent); color: #fff; border-radius: 10px; padding: 2px 9px; font-size: 0.78rem; font-weight: 700; }
.btn-icon { background: rgba(255,255,255,0.12); border: none; color: #fff; border-radius: 8px; padding: 7px 10px; cursor: pointer; font-size: 1rem; line-height: 1; }

/* â”€â”€ BOTTOM NAV (mobile) â”€â”€ */
.bottom-nav {
  position: fixed; bottom: 0; left: 0; right: 0; z-index: 100;
  background: var(--primary-darker); border-top: 1px solid rgba(255,255,255,0.1);
  display: flex; padding-bottom: env(safe-area-inset-bottom);
  box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
}
.bottom-nav-item {
  flex: 1; display: flex; flex-direction: column; align-items: center;
  justify-content: center; padding: 8px 4px; cursor: pointer; border: none; background: none;
  color: #64748B; font-family: inherit; font-size: 0.65rem; gap: 3px; transition: all 0.2s;
  border-top: 2px solid transparent;
}
.bottom-nav-item .nav-icon { font-size: 1.3rem; line-height: 1; }
.bottom-nav-item.active { color: var(--accent2); border-top-color: var(--accent2); }
.bottom-nav-item span { white-space: nowrap; }

/* â”€â”€ MAIN SCROLL AREA â”€â”€ */
.app-body { flex: 1; overflow-y: auto; padding: 16px 16px 80px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page { display: none; }
.page.active { display: block; animation: fadeUp 0.25s ease; }
@keyframes fadeUp { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:none; } }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COMPONENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page-header { margin-bottom: 16px; }
.page-title { font-family:'Gmarket Sans',sans-serif; font-size:1.25rem; font-weight:700; color:var(--primary-dark); }
.page-sub { font-size:0.82rem; color:var(--text-muted); margin-top:2px; }

/* Cards */
.card {
  background: var(--surface); border-radius: var(--radius); padding: 18px;
  box-shadow: var(--shadow); margin-bottom: 14px;
  border: 1px solid var(--border);
}
.card-title { font-size:0.95rem; font-weight:700; color:var(--primary-dark); margin-bottom:12px; display:flex; align-items:center; gap:6px; }

/* Stat Grid */
.stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 14px; }
.stat-card {
  background: var(--surface); border-radius: var(--radius-sm); padding: 14px 12px;
  border: 1px solid var(--border); box-shadow: var(--shadow);
}
.stat-label { font-size: 0.72rem; color: var(--text-muted); margin-bottom: 4px; }
.stat-value { font-size: 1.3rem; font-weight: 700; font-family:'Gmarket Sans',sans-serif; color: var(--primary-dark); }
.stat-value.accent { color: var(--accent); }
.stat-value.blue { color: var(--primary); }
.stat-value.green { color: var(--success); }
.stat-value.warn { color: var(--warning); }

/* Buttons */
.btn {
  display: inline-flex; align-items: center; justify-content: center; gap: 6px;
  border: none; border-radius: var(--radius-sm); padding: 12px 20px;
  font-family: inherit; font-size: 0.9rem; font-weight: 600; cursor: pointer;
  transition: all 0.18s; white-space: nowrap; letter-spacing: -0.2px;
  -webkit-tap-highlight-color: transparent;
}
.btn:active { transform: scale(0.97); }
.btn-primary { background: var(--primary); color: #fff; }
.btn-primary:hover { background: var(--primary-dark); }
.btn-accent { background: var(--accent); color: #fff; }
.btn-accent:hover { background: #D97706; }
.btn-outline { background: transparent; border: 1.5px solid var(--border-strong); color: var(--primary); }
.btn-outline:hover { background: var(--surface2); }
.btn-danger { background: var(--danger); color: #fff; }
.btn-success { background: var(--success); color: #fff; }
.btn-warn { background: var(--warning); color: #fff; }
.btn-info { background: var(--info); color: #fff; }
.btn-ghost { background: transparent; color: var(--text-muted); border: 1px solid var(--border); }
.btn-sm { padding: 7px 14px; font-size: 0.82rem; border-radius: 8px; }
.btn-xs { padding: 4px 10px; font-size: 0.76rem; border-radius: 6px; font-weight: 500; }
.btn-full { width: 100%; }
.btn-row { display: flex; gap: 8px; flex-wrap: wrap; }

/* Forms */
.form-group { margin-bottom: 14px; }
.form-label { display:block; font-size:0.82rem; font-weight:600; color:var(--text-muted); margin-bottom:6px; }
.form-label .req { color:var(--danger); margin-left:2px; }
.form-input, .form-select, .form-textarea {
  width: 100%; border: 1.5px solid var(--border); border-radius: var(--radius-sm);
  padding: 11px 13px; font-family: inherit; font-size: 0.92rem;
  background: var(--surface2); color: var(--text); outline: none;
  transition: border-color 0.2s, box-shadow 0.2s; -webkit-appearance: none;
}
.form-input:focus, .form-select:focus, .form-textarea:focus {
  border-color: var(--primary-light); background: #fff;
  box-shadow: 0 0 0 3px rgba(59,130,246,0.1);
}
.form-textarea { resize: vertical; min-height: 72px; }
.form-row-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
.form-hint { font-size:0.76rem; color:var(--text-muted); margin-top:4px; }

/* Badges & Tags */
.badge {
  display:inline-flex; align-items:center; padding:3px 9px;
  border-radius:12px; font-size:0.74rem; font-weight:700; white-space:nowrap;
}
.badge-pending { background:#FEF3C7; color:#92400E; }
.badge-approved { background:#D1FAE5; color:#065F46; }
.badge-rejected { background:#FEE2E2; color:#991B1B; }
.badge-cancelled { background:#F1F5F9; color:#475569; }
.badge-mod-approved { background:#DBEAFE; color:#1E40AF; }

/* Table */
.table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; }
table { width:100%; border-collapse:collapse; font-size:0.83rem; }
th { background:var(--primary-dark); color:#fff; padding:9px 10px; text-align:left; font-weight:600; white-space:nowrap; font-size:0.8rem; }
td { padding:9px 10px; border-bottom:1px solid var(--border); }
tr:last-child td { border-bottom: none; }
tr:hover td { background:var(--surface2); }
.td-nowrap { white-space: nowrap; }

/* Credit Bar */
.credit-bar-bg { background:var(--border); border-radius:4px; height:8px; overflow:hidden; margin-top:4px; }
.credit-bar-fill { height:100%; border-radius:4px; background:linear-gradient(90deg, var(--primary-light), var(--primary)); transition:width 0.4s; }

/* Section divider */
.section-divider { border:none; border-top:1px solid var(--border); margin:16px 0; }

/* Pill select */
.pill-select-row { display:flex; gap:6px; flex-wrap:wrap; }
.pill-opt {
  padding:7px 14px; border-radius:20px; border:1.5px solid var(--border);
  background:var(--surface2); color:var(--text-muted); font-size:0.83rem; cursor:pointer;
  font-family:inherit; font-weight:500; transition:all 0.15s;
}
.pill-opt.selected { border-color:var(--primary); background:var(--primary); color:#fff; }

/* Amount display */
.amount-display {
  background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
  border-radius: var(--radius-sm); padding: 14px 16px; color: #fff;
  display: flex; justify-content: space-between; align-items: center;
}
.amount-display .label { font-size:0.82rem; opacity:0.8; }
.amount-display .value { font-size:1.3rem; font-weight:700; font-family:'Gmarket Sans',sans-serif; }

/* App entry card */
.entry-card {
  background: var(--surface); border: 1.5px solid var(--border-strong);
  border-radius: var(--radius); padding: 16px; margin-bottom: 12px;
  box-shadow: 0 2px 12px rgba(26,86,219,0.07);
}
.entry-card-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:14px; }
.entry-card-title { font-weight:700; color:var(--primary-dark); font-size:0.95rem; display:flex; align-items:center; gap:6px; }
.entry-num { background:var(--primary); color:#fff; width:24px; height:24px; border-radius:50%; display:inline-flex; align-items:center; justify-content:center; font-size:0.78rem; font-weight:700; }

/* Participant row */
.participant-block { background:var(--surface2); border-radius:var(--radius-sm); padding:12px; margin-bottom:8px; border:1px solid var(--border); }
.participant-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
.participant-label { font-size:0.8rem; font-weight:700; color:var(--primary); }
.participant-subtotal { font-size:0.82rem; font-weight:700; color:var(--primary-dark); }

/* Receipt upload */
.receipt-zone {
  border: 2px dashed var(--border-strong); border-radius: var(--radius-sm);
  padding: 20px 16px; text-align: center; cursor: pointer; transition: all 0.2s;
  background: var(--surface2); position: relative;
}
.receipt-zone:hover, .receipt-zone:active { border-color: var(--primary); background: #EFF6FF; }
.receipt-zone.has-file { border-color: var(--success); border-style: solid; background: #F0FDF4; }
.receipt-zone img { max-width: 100%; max-height: 160px; border-radius: 8px; margin-top: 10px; object-fit: contain; }
.receipt-remove { position:absolute; top:8px; right:8px; background:var(--danger); color:#fff; border:none; border-radius:50%; width:24px; height:24px; cursor:pointer; font-size:0.8rem; display:flex; align-items:center; justify-content:center; }

/* Entry total bar */
.entry-total { background:linear-gradient(135deg,#EFF6FF,#DBEAFE); border-radius:8px; padding:10px 14px; display:flex; justify-content:space-between; align-items:center; margin-top:10px; border:1px solid var(--border-strong); }
.entry-total .label { font-size:0.82rem; color:var(--primary); font-weight:600; }
.entry-total .value { font-size:1.05rem; font-weight:700; color:var(--primary-dark); }

/* Floating submit */
.floating-bar {
  position: fixed; bottom: 56px; left: 0; right: 0; z-index: 90;
  background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
  border-top: 1px solid var(--border); padding: 10px 16px;
  display: flex; align-items: center; justify-content: space-between; gap: 10px;
  box-shadow: 0 -4px 20px rgba(26,86,219,0.12);
}
.floating-total { font-size:0.82rem; color:var(--text-muted); }
.floating-total strong { display:block; font-size:1.05rem; color:var(--primary-dark); }

/* App list item (mobile card) */
.app-list-item {
  background: var(--surface); border-radius: var(--radius-sm); padding: 14px;
  border: 1px solid var(--border); margin-bottom: 10px; cursor: pointer;
  transition: all 0.15s; box-shadow: var(--shadow);
}
.app-list-item:active { transform: scale(0.98); }
.app-list-row { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:6px; }
.app-list-name { font-weight:700; font-size:0.92rem; color:var(--text); }
.app-list-date { font-size:0.78rem; color:var(--text-muted); }
.app-list-amount { font-size:1.05rem; font-weight:700; color:var(--primary-dark); font-family:'Gmarket Sans',sans-serif; }
.app-list-meta { font-size:0.78rem; color:var(--text-muted); }
.app-list-actions { display:flex; gap:6px; margin-top:8px; padding-top:8px; border-top:1px solid var(--border); }

/* Toast */
#toast-container { position:fixed; top:70px; left:16px; right:16px; z-index:9999; display:flex; flex-direction:column; gap:8px; pointer-events:none; }
.toast {
  background:var(--primary-darker); color:#fff; border-radius:12px; padding:13px 18px;
  font-size:0.88rem; box-shadow:0 4px 20px rgba(0,0,0,0.3);
  animation:slideDown 0.3s ease; display:flex; align-items:center; gap:10px; pointer-events:auto;
}
.toast.success { background:#065F46; }
.toast.error { background:#991B1B; }
.toast.warning { background:#92400E; }
@keyframes slideDown { from { opacity:0; transform:translateY(-12px); } to { opacity:1; transform:none; } }

/* Modal */
.modal-overlay {
  display:none; position:fixed; inset:0; background:rgba(0,0,0,0.55);
  z-index:500; align-items:flex-end; justify-content:center;
  backdrop-filter:blur(4px);
}
.modal-overlay.open { display:flex; }
.modal-overlay.center { align-items:center; }
.modal {
  background:#fff; border-radius:24px 24px 0 0; padding:24px 20px;
  width:100%; max-height:90vh; overflow-y:auto;
  box-shadow:0 -8px 40px rgba(0,0,0,0.3);
  animation: slideUp 0.3s ease;
}
.modal.center-modal { border-radius: 24px; max-width: 480px; width: calc(100% - 32px); animation: fadeIn 0.25s; }
@keyframes slideUp { from { transform:translateY(40px); opacity:0; } to { transform:none; opacity:1; } }
@keyframes fadeIn { from { opacity:0; transform:scale(0.97); } to { opacity:1; transform:none; } }
.modal-handle { width:36px; height:4px; background:var(--border); border-radius:2px; margin:0 auto 18px; }
.modal-title { font-size:1.05rem; font-weight:700; color:var(--primary-dark); margin-bottom:16px; display:flex; align-items:center; gap:8px; }
.modal-actions { display:flex; gap:8px; margin-top:20px; }
.modal-actions .btn { flex:1; }

/* Pull indicator */
.pending-dot { width:8px; height:8px; border-radius:50%; background:var(--accent); display:inline-block; animation:pulse 1.5s infinite; }
@keyframes pulse { 0%,100%{ opacity:1; } 50%{ opacity:0.3; } }

/* Highlight box */
.highlight { background:linear-gradient(135deg,rgba(59,130,246,0.08),rgba(147,197,253,0.1)); border:1px solid var(--border-strong); border-radius:var(--radius-sm); padding:12px 14px; }

/* Misc */
.flex-between { display:flex; justify-content:space-between; align-items:center; }
.flex-center { display:flex; align-items:center; gap:8px; }
.text-muted { color:var(--text-muted); font-size:0.82rem; }
.text-right { text-align:right; }
.mt-1 { margin-top:4px; }
.mt-2 { margin-top:8px; }
.mt-3 { margin-top:14px; }
.mb-2 { margin-bottom:8px; }
.mb-3 { margin-bottom:14px; }
.bold { font-weight:700; }
.empty-state { text-align:center; padding:40px 20px; color:var(--text-muted); }
.empty-icon { font-size:3rem; margin-bottom:10px; }

/* Admin detail panel */
.detail-section { margin-bottom:16px; }
.detail-row { display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid var(--border); font-size:0.88rem; }
.detail-row:last-child { border-bottom:none; }
.detail-key { color:var(--text-muted); }
.detail-val { font-weight:600; text-align:right; flex:1; margin-left:12px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PRINT STYLES â€” A4 ONE PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media print {
  * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
  body, html { margin: 0; padding: 0; background: #fff !important; }
  #app, header, .bottom-nav, .app-body, #toast-container { display: none !important; }
  .modal-overlay { display: none !important; }
  #print-area {
    display: block !important; position: fixed; inset: 0;
    background: #fff; z-index: 99999;
  }
}
#print-area { display: none; }
.print-page {
  width: 210mm; min-height: 297mm; margin: 0 auto;
  padding: 18mm 16mm 14mm; font-family: 'Noto Sans KR', sans-serif;
  font-size: 11pt; color: #000; background: #fff; box-sizing: border-box;
  display: flex; flex-direction: column;
}
.print-header-bar { background: #1e3a8a; color: #fff; padding: 10px 16px; border-radius: 4px; margin-bottom: 6px; }
.print-main-title { font-size: 14pt; font-weight: 900; }
.print-sub { font-size: 9pt; opacity: 0.85; margin-top: 2px; }
.print-stamp-row { display: flex; justify-content: flex-end; margin-bottom: 12px; }
.print-stamp { border: 2px solid #1e3a8a; border-radius: 4px; padding: 6px 20px; font-size: 9pt; text-align: center; }
.print-stamp .stamp-label { font-weight: 700; color: #1e3a8a; }
.print-section { margin-bottom: 14px; }
.print-section-title { font-size: 10pt; font-weight: 700; color: #1e3a8a; border-bottom: 2px solid #1e3a8a; padding-bottom: 4px; margin-bottom: 8px; }
.print-table { width: 100%; border-collapse: collapse; font-size: 10pt; }
.print-table th { background: #1e3a8a; color: #fff; padding: 7px 10px; text-align: left; font-weight: 600; }
.print-table td { padding: 7px 10px; border: 1px solid #ccc; vertical-align: top; }
.print-table tr:nth-child(even) td { background: #F8F9FA; }
.print-total-box { border: 2px solid #1e3a8a; border-radius: 4px; padding: 10px 16px; margin-bottom: 14px; display: flex; justify-content: space-between; align-items: center; }
.print-total-label { font-size: 11pt; font-weight: 700; color: #1e3a8a; }
.print-total-amount { font-size: 14pt; font-weight: 900; color: #1e3a8a; }
.print-bank-box { border: 1.5px solid #93C5FD; border-radius: 4px; padding: 12px 16px; background: #EFF6FF; }
.print-bank-row { display: flex; gap: 8px; margin-bottom: 5px; font-size: 10pt; }
.print-bank-key { color: #1e40af; font-weight: 700; min-width: 70px; }
.print-footer { margin-top: auto; padding-top: 12px; border-top: 1px solid #ccc; display: flex; justify-content: space-between; font-size: 8pt; color: #888; }
.print-sig { border: 1px solid #ccc; border-radius: 4px; padding: 10px 20px; text-align: center; font-size: 9pt; }
.print-sig-line { border-top: 1px solid #999; width: 80px; margin: 18px auto 4px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN SPECIFIC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.admin-tag { background:rgba(255,215,0,0.2); border:1px solid rgba(255,215,0,0.5); color:#7C3AED; border-radius:4px; padding:2px 7px; font-size:0.72rem; font-weight:700; }
.filter-row { display:flex; gap:8px; margin-bottom:14px; flex-wrap:wrap; }
.filter-row input, .filter-row select { flex:1; min-width:120px; font-size:0.85rem; padding:9px 12px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE TWEAKS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 380px) {
  .stats-grid { grid-template-columns: 1fr 1fr; }
  .form-row-2 { grid-template-columns: 1fr; }
  .form-row-3 { grid-template-columns: 1fr 1fr; }
}
@media (min-width: 600px) {
  .app-body { max-width: 600px; margin: 0 auto; }
  .floating-bar { max-width: 600px; left: 50%; transform: translateX(-50%); }
  .bottom-nav { max-width: 600px; left: 50%; transform: translateX(-50%); }
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LOADING â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="loading-screen">
  <div class="loading-dice">ğŸ²</div>
  <div class="loading-title">ë³´ë™ë³´ë™ ê°“ìƒì§€ì›ê¸ˆ</div>
  <div class="loading-sub">2026 ë³´ë“œê²Œì„ ì§€ì›ê¸ˆ ì‹ ì²­ ì‹œìŠ¤í…œ</div>
  <div class="spinner"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LOGIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="login-page">
  <div class="login-container">
    <div class="login-hero">
      <span class="login-emoji">ğŸ²</span>
      <div class="login-title">2026 ë³´ë™ë³´ë™<br>ê°“ìƒì§€ì›ê¸ˆ</div>
      <div class="login-subtitle">ë³´ë“œê²Œì„ Â· ë°©íƒˆì¶œ ì§€ì›ê¸ˆ ì‹ ì²­ í”Œë«í¼</div>
    </div>

    <div class="login-card">
      <div class="login-tab-row">
        <button class="login-tab active" onclick="switchLoginTab('login')">ë¡œê·¸ì¸</button>
        <button class="login-tab" onclick="switchLoginTab('signup')">íšŒì›ê°€ì…</button>
      </div>

      <!-- ë¡œê·¸ì¸ íŒ¨ë„ -->
      <div class="login-panel active" id="panel-login">
        <!-- ì¼ë°˜ ë¡œê·¸ì¸ -->
        <div class="fl-input">
          <input type="email" id="login-email" placeholder=" " autocomplete="email">
          <label>ì´ë©”ì¼</label>
        </div>
        <div class="fl-input">
          <input type="password" id="login-pw" placeholder=" " autocomplete="current-password" onkeydown="if(event.key==='Enter')doEmailLogin()">
          <label>ë¹„ë°€ë²ˆí˜¸</label>
        </div>
        <button class="btn btn-primary btn-full" onclick="doEmailLogin()" style="margin-bottom:14px;">ë¡œê·¸ì¸</button>

        <div class="form-divider"><span>ê°„í¸ ë¡œê·¸ì¸</span></div>

        <button class="sso-btn sso-naver" onclick="loginSSO('naver')">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="white"><path d="M16.273 12.845L7.376 0H0v24h7.727V11.155L16.624 24H24V0h-7.727z"/></svg>
          ë„¤ì´ë²„ë¡œ ë¡œê·¸ì¸
        </button>
        <button class="sso-btn sso-google" onclick="loginSSO('google')">
          <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
          Googleë¡œ ë¡œê·¸ì¸
        </button>
      </div>

      <!-- íšŒì›ê°€ì… íŒ¨ë„ -->
      <div class="login-panel" id="panel-signup">
        <div class="signup-intro">
          SNS ê³„ì •ìœ¼ë¡œ ê°„í¸í•˜ê²Œ ê°€ì…í•˜ì„¸ìš”.<br>ê´€ë¦¬ì ìŠ¹ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
        </div>
        <button class="sso-btn sso-naver" onclick="loginSSO('naver','signup')">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="white"><path d="M16.273 12.845L7.376 0H0v24h7.727V11.155L16.624 24H24V0h-7.727z"/></svg>
          ë„¤ì´ë²„ë¡œ ê°€ì…
        </button>
        <button class="sso-btn sso-google" onclick="loginSSO('google','signup')">
          <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
          Googleë¡œ ê°€ì…
        </button>
        <div class="form-divider"><span>ì§ì ‘ ì…ë ¥</span></div>
        <div class="fl-input">
          <input type="text" id="signup-name" placeholder=" ">
          <label>ì´ë¦„</label>
        </div>
        <div class="fl-input">
          <input type="email" id="signup-email" placeholder=" ">
          <label>ì´ë©”ì¼</label>
        </div>
        <div class="fl-input">
          <input type="password" id="signup-pw" placeholder=" " value="4321">
          <label>ë¹„ë°€ë²ˆí˜¸</label>
        </div>
        <button class="btn btn-primary btn-full" onclick="doSignup()">ê°€ì… ì‹ ì²­</button>
      </div>
    </div>

    <!-- SSO Simulator -->
    <div id="sso-sim" style="display:none; background:#fff; border-radius:20px; padding:20px; width:100%; max-width:400px; margin-top:12px; box-shadow:0 8px 32px rgba(0,0,0,0.3);">
      <div style="font-weight:700; color:var(--primary-dark); margin-bottom:4px;" id="sso-sim-title">ê³„ì • ì„ íƒ</div>
      <div style="font-size:0.8rem; color:#888; margin-bottom:14px;">ğŸ§ª í…ŒìŠ¤íŠ¸ ëª¨ë“œ â€” ì‹¤ì œ ë°°í¬ ì‹œ API í‚¤ ì—°ë™</div>
      <div class="fl-input">
        <input type="email" id="sso-email" placeholder=" ">
        <label>ì´ë©”ì¼</label>
      </div>
      <div class="fl-input">
        <input type="password" id="sso-pw" placeholder=" " value="4321">
        <label>ë¹„ë°€ë²ˆí˜¸</label>
      </div>
      <div id="sso-quick-accounts" style="margin-bottom:12px;"></div>
      <div style="display:flex; gap:8px;">
        <button class="btn btn-outline btn-sm" style="flex:1" onclick="hideSSOSim()">ì·¨ì†Œ</button>
        <button class="btn btn-primary btn-sm" style="flex:2" id="sso-sim-btn" onclick="doSSOLogin()">ë¡œê·¸ì¸</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• APP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="app" style="display:flex; flex-direction:column;">
  <header class="app-header">
    <div class="app-header-logo" onclick="goHome()">
      ğŸ² ë³´ë™ë³´ë™ ê°“ìƒì§€ì›ê¸ˆ
      <small>2026 ë³´ë“œê²Œì„ ì§€ì›ê¸ˆ</small>
    </div>
    <div class="header-user">
      <div class="header-chip">
        <span id="hdr-name">-</span>
        <span class="credit-pill" id="hdr-credit">â‚©0</span>
      </div>
      <button class="btn-icon" onclick="logout()" title="ë¡œê·¸ì•„ì›ƒ">â†©</button>
    </div>
  </header>

  <div class="app-body">
    <!-- â”€â”€ ëŒ€ì‹œë³´ë“œ â”€â”€ -->
    <div class="page active" id="page-dashboard">
      <div class="page-header">
        <div class="page-title" id="dash-greeting">ì•ˆë…•í•˜ì„¸ìš” ğŸ‘‹</div>
        <div class="page-sub">ì§€ì›ê¸ˆ í˜„í™©ì„ í™•ì¸í•˜ì„¸ìš”</div>
      </div>
      <div class="stats-grid" id="dash-stats"></div>
      <div class="card">
        <div class="card-title">ğŸ• ìµœê·¼ ì‹ ì²­ ë‚´ì—­</div>
        <div id="dash-recent"></div>
      </div>
      <button class="btn btn-accent btn-full" onclick="navigateTo('apply')" style="margin-top:4px;">
        âœï¸ ì§€ì›ê¸ˆ ì‹ ì²­í•˜ê¸°
      </button>
    </div>

    <!-- â”€â”€ ì‹ ì²­ â”€â”€ -->
    <div class="page" id="page-apply">
      <div class="page-header">
        <div class="page-title">âœï¸ ì§€ì›ê¸ˆ ì‹ ì²­</div>
        <div class="page-sub">ì˜ìˆ˜ì¦ ì²¨ë¶€ í•„ìˆ˜ Â· í¬ë ˆë”§ í•œë„ ë‚´ ì‹ ì²­</div>
      </div>
      <div class="card" id="apply-credit-card"></div>
      <div id="app-entries"></div>
      <button class="btn btn-outline btn-full" onclick="addAppEntry()" style="margin-bottom:14px;">
        ï¼‹ ì‹ ì²­ í•­ëª© ì¶”ê°€
      </button>

      <div class="card">
        <div class="card-title">ğŸ¦ í™˜ê¸‰ ê³„ì¢Œ ì •ë³´</div>
        <div class="form-group">
          <label class="form-label">ì˜ˆê¸ˆì£¼<span class="req">*</span></label>
          <input class="form-input" type="text" id="apply-acname" placeholder="ì˜ˆê¸ˆì£¼ ì„±í•¨">
        </div>
        <div class="form-row-2">
          <div class="form-group">
            <label class="form-label">ì€í–‰ëª…<span class="req">*</span></label>
            <select class="form-select" id="apply-bank">
              <option value="">ì„ íƒ</option>
              <option>êµ­ë¯¼ì€í–‰</option><option>ì‹ í•œì€í–‰</option><option>ìš°ë¦¬ì€í–‰</option>
              <option>í•˜ë‚˜ì€í–‰</option><option>ë†í˜‘ì€í–‰</option><option>ê¸°ì—…ì€í–‰</option>
              <option>ì¹´ì¹´ì˜¤ë±…í¬</option><option>í† ìŠ¤ë±…í¬</option><option>ì¼€ì´ë±…í¬</option>
              <option>SCì œì¼ì€í–‰</option><option>ì”¨í‹°ì€í–‰</option><option>ê¸°íƒ€</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">ê³„ì¢Œë²ˆí˜¸<span class="req">*</span></label>
            <input class="form-input" type="text" id="apply-acnum" placeholder="ìˆ«ìë§Œ">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">ë¹„ê³ </label>
          <textarea class="form-textarea" id="apply-note" placeholder="ì „ë‹¬ì‚¬í•­ (ì„ íƒ)"></textarea>
        </div>
      </div>
      <!-- spacer for floating bar -->
      <div style="height:72px;"></div>
    </div>

    <!-- â”€â”€ ë‚´ ì‹ ì²­ ë‚´ì—­ â”€â”€ -->
    <div class="page" id="page-myapps">
      <div class="page-header flex-between">
        <div><div class="page-title">ğŸ“‹ ë‚´ ì‹ ì²­ ë‚´ì—­</div></div>
        <button class="btn btn-outline btn-sm" onclick="renderMyApps()">ìƒˆë¡œê³ ì¹¨</button>
      </div>
      <div id="myapps-list"></div>
    </div>

    <!-- â”€â”€ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ â”€â”€ -->
    <div class="page" id="page-admin">
      <div class="page-header flex-between">
        <div><div class="page-title">ğŸ›¡ï¸ ê´€ë¦¬ì</div><div class="page-sub">ì „ì²´ ì‹ ì²­ í˜„í™©</div></div>
        <span class="admin-tag">ADMIN</span>
      </div>
      <div class="stats-grid" id="admin-stats"></div>

      <div class="card">
        <div class="card-title flex-between">
          <span>â³ ìŠ¹ì¸ ëŒ€ê¸° <span class="pending-dot"></span></span>
          <button class="btn btn-outline btn-xs" onclick="navigateTo('admin-all')">ì „ì²´ë³´ê¸°</button>
        </div>
        <div id="admin-pending"></div>
      </div>
    </div>

    <!-- â”€â”€ ê´€ë¦¬ì: ì „ì²´ ì‹ ì²­ â”€â”€ -->
    <div class="page" id="page-admin-all">
      <div class="page-header">
        <div class="page-title">ğŸ“‚ ì „ì²´ ì‹ ì²­ ì·¨í•©</div>
      </div>
      <div class="filter-row">
        <input class="form-input" type="search" id="admin-search" placeholder="ê²€ìƒ‰â€¦" oninput="renderAdminAll()">
        <select class="form-select" id="admin-status-filter" onchange="renderAdminAll()" style="min-width:110px;">
          <option value="">ì „ì²´</option>
          <option value="pending">ëŒ€ê¸°</option>
          <option value="approved">ìŠ¹ì¸</option>
          <option value="mod-approved">ìˆ˜ì •ìŠ¹ì¸</option>
          <option value="rejected">ë°˜ë ¤</option>
          <option value="cancelled">ì·¨ì†Œ</option>
        </select>
      </div>
      <div class="flex-between mb-2" style="gap:8px;">
        <div id="admin-all-count" class="text-muted"></div>
        <button class="btn btn-outline btn-sm" onclick="exportCSV()">ğŸ“¥ CSV</button>
      </div>
      <div id="admin-all-list"></div>
    </div>

    <!-- â”€â”€ ê´€ë¦¬ì: íšŒì› ê´€ë¦¬ â”€â”€ -->
    <div class="page" id="page-admin-members">
      <div class="page-header flex-between">
        <div class="page-title">ğŸ‘¥ íšŒì› ê´€ë¦¬</div>
        <button class="btn btn-accent btn-sm" onclick="openCreateUserModal()">ï¼‹ ê³„ì • ìƒì„±</button>
      </div>
      <div id="admin-members-list"></div>
    </div>

    <!-- â”€â”€ ê´€ë¦¬ì: ë¡œê·¸ â”€â”€ -->
    <div class="page" id="page-admin-logs">
      <div class="page-header flex-between">
        <div class="page-title">ğŸ“œ ì‹œìŠ¤í…œ ë¡œê·¸</div>
        <button class="btn btn-ghost btn-sm" onclick="clearLogs()">ì´ˆê¸°í™”</button>
      </div>
      <div class="card" id="logs-content"></div>
    </div>
  </div>

  <!-- Bottom Nav -->
  <nav class="bottom-nav" id="bottom-nav"></nav>

  <!-- Floating submit bar (apply page) -->
  <div class="floating-bar" id="floating-bar" style="display:none;">
    <div class="floating-total">
      ì´ ì‹ ì²­ê¸ˆì•¡<strong id="float-total">â‚©0</strong>
    </div>
    <button class="btn btn-primary" onclick="submitApplication()" style="padding:11px 22px;">
      ğŸ“¨ ì‹ ì²­ ì œì¶œ
    </button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODALS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- ì‹ ì²­ ìƒì„¸ / ê´€ë¦¬ì ë·° -->
<div class="modal-overlay" id="modal-detail">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title" id="modal-detail-title">ì‹ ì²­ ìƒì„¸</div>
    <div id="modal-detail-body"></div>
    <div class="modal-actions" id="modal-detail-actions"></div>
  </div>
</div>

<!-- ê´€ë¦¬ì ìˆ˜ì • ëª¨ë‹¬ -->
<div class="modal-overlay center" id="modal-edit">
  <div class="modal center-modal">
    <div class="modal-title">âœï¸ ì‹ ì²­ ìˆ˜ì • (ê´€ë¦¬ì)</div>
    <div id="modal-edit-body"></div>
    <div class="modal-actions" id="modal-edit-actions"></div>
  </div>
</div>

<!-- ê³„ì • ìƒì„± -->
<div class="modal-overlay center" id="modal-create-user">
  <div class="modal center-modal">
    <div class="modal-title">â• ê³„ì • ìƒì„±</div>
    <div class="form-group"><label class="form-label">ì´ë¦„</label><input class="form-input" type="text" id="nu-name"></div>
    <div class="form-group"><label class="form-label">ì´ë©”ì¼</label><input class="form-input" type="email" id="nu-email"></div>
    <div class="form-group"><label class="form-label">ë¹„ë°€ë²ˆí˜¸</label><input class="form-input" type="password" id="nu-pw" value="4321"></div>
    <div class="form-group"><label class="form-label">ì´ˆê¸° í¬ë ˆë”§ (ì›)</label><input class="form-input" type="number" id="nu-credit" value="30000"></div>
    <div class="form-group"><label class="form-label">ì—­í• </label>
      <select class="form-select" id="nu-role">
        <option value="user">ì¼ë°˜ íšŒì›</option>
        <option value="admin">ê´€ë¦¬ì</option>
      </select>
    </div>
    <div class="modal-actions">
      <button class="btn btn-outline" onclick="closeModal('modal-create-user')">ì·¨ì†Œ</button>
      <button class="btn btn-primary" onclick="createUser()">ìƒì„±</button>
    </div>
  </div>
</div>

<!-- í¬ë ˆë”§ ìˆ˜ì • -->
<div class="modal-overlay center" id="modal-credit">
  <div class="modal center-modal">
    <div class="modal-title">ğŸ’° í¬ë ˆë”§ ìˆ˜ì •</div>
    <div id="modal-credit-body"></div>
    <div class="modal-actions">
      <button class="btn btn-outline" onclick="closeModal('modal-credit')">ì·¨ì†Œ</button>
      <button class="btn btn-primary" onclick="saveCreditEdit()">ì €ì¥</button>
    </div>
  </div>
</div>

<!-- ì¸ì‡„ ë¯¸ë¦¬ë³´ê¸° -->
<div class="modal-overlay center" id="modal-print">
  <div class="modal center-modal" style="max-width:520px;">
    <div class="modal-title">ğŸ–¨ï¸ ì¸ì‡„ ë¯¸ë¦¬ë³´ê¸°</div>
    <div id="modal-print-preview" style="border:1px solid var(--border);border-radius:8px;padding:12px;background:#fafafa;max-height:60vh;overflow-y:auto;font-size:0.82rem;"></div>
    <div class="modal-actions">
      <button class="btn btn-outline" onclick="closeModal('modal-print')">ë‹«ê¸°</button>
      <button class="btn btn-primary" onclick="doPrint()">ğŸ–¨ï¸ ì¸ì‡„</button>
    </div>
  </div>
</div>

<!-- ì¸ì‡„ìš© ìˆ¨ê¹€ ì˜ì—­ -->
<div id="print-area"></div>

<!-- Toast -->
<div id="toast-container"></div>

<script>
'use strict';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA STORE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const DB = {
  get(k) { try { return JSON.parse(localStorage.getItem('bg26_'+k)); } catch { return null; } },
  set(k,v) { try { localStorage.setItem('bg26_'+k, JSON.stringify(v)); } catch(e){} },
  users() { return this.get('users') || []; },
  apps() { return this.get('apps') || []; },
  logs() { return this.get('logs') || []; },
  saveUsers(u) { this.set('users', u); },
  saveApps(a) { this.set('apps', a); },
  log(msg, uid) {
    const logs = this.logs();
    logs.unshift({ id: Date.now(), ts: new Date().toISOString(), msg, uid: uid||'system' });
    if (logs.length > 600) logs.length = 600;
    this.set('logs', logs);
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SEED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function seed() {
  if (DB.get('seeded_v3')) return;
  DB.saveUsers([
    { id:'admin', email:'admin', name:'ê´€ë¦¬ì', role:'admin', status:'approved', provider:'local', pw:'4321', creditTotal:0, creditUsed:0, creditPending:0, createdAt:now() },
    { id:'u1', email:'__sso@naver.com', name:'í…ŒìŠ¤íŠ¸ìœ ì €1', role:'user', status:'approved', provider:'naver', pw:'4321', creditTotal:30000, creditUsed:0, creditPending:0, createdAt:now() },
    { id:'u2', email:'__sso1@naver.com', name:'í…ŒìŠ¤íŠ¸ìœ ì €2', role:'user', status:'approved', provider:'naver', pw:'4321', creditTotal:30000, creditUsed:0, creditPending:0, createdAt:now() },
  ]);
  DB.set('seeded_v3', true);
  DB.log('ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTH STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let ME = null;
let ssoMode = 'login'; // 'login' | 'signup'
let ssoProvider = '';

function switchLoginTab(tab) {
  document.querySelectorAll('.login-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.login-panel').forEach(p => p.classList.remove('active'));
  const idx = tab === 'login' ? 0 : 1;
  document.querySelectorAll('.login-tab')[idx].classList.add('active');
  document.getElementById('panel-' + tab).classList.add('active');
}

function loginSSO(provider, mode='login') {
  ssoProvider = provider; ssoMode = mode;
  const label = provider === 'naver' ? 'ë„¤ì´ë²„' : 'Google';
  document.getElementById('sso-sim-title').textContent = `${label} ${mode==='signup'?'ê°€ì…':'ë¡œê·¸ì¸'}`;
  document.getElementById('sso-sim-btn').textContent = mode==='signup' ? 'ê°€ì… ì‹ ì²­' : 'ë¡œê·¸ì¸';
  document.getElementById('sso-email').value = '';
  document.getElementById('sso-pw').value = '4321';

  // quick accounts
  const users = DB.users().filter(u => u.provider === provider);
  const qEl = document.getElementById('sso-quick-accounts');
  if (users.length && mode==='login') {
    qEl.innerHTML = '<div style="font-size:0.78rem;color:#999;margin-bottom:6px;">â€” ê¸°ì¡´ ê³„ì • â€”</div>' +
      users.map(u => `<button onclick="quickSelect('${u.email}')" style="display:block;width:100%;text-align:left;padding:7px 10px;border-radius:8px;border:1px solid var(--border);background:var(--surface2);font-size:0.83rem;margin-bottom:4px;cursor:pointer;font-family:inherit;">${u.name} (${u.email})</button>`).join('');
  } else { qEl.innerHTML = ''; }

  document.getElementById('sso-sim').style.display = 'block';
}
function quickSelect(email) { document.getElementById('sso-email').value = email; }
function hideSSOSim() { document.getElementById('sso-sim').style.display = 'none'; }

function doSSOLogin() {
  const email = document.getElementById('sso-email').value.trim();
  const pw = document.getElementById('sso-pw').value;
  if (!email) { toast('ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”','error'); return; }

  const users = DB.users();
  let user = users.find(u => u.email === email);

  if (ssoMode === 'signup' || !user) {
    // Register
    if (user) { toast('ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤','warning'); return; }
    const nu = { id:'u_'+Date.now(), email, name:email.split('@')[0], role:'user', status:'pending', provider:ssoProvider, pw, creditTotal:0, creditUsed:0, creditPending:0, createdAt:now() };
    users.push(nu); DB.saveUsers(users);
    DB.log(`ì‹ ê·œ ê°€ì…: ${email}`);
    toast('ê°€ì… ì‹ ì²­ ì™„ë£Œ! ê´€ë¦¬ì ìŠ¹ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤','warning');
    hideSSOSim(); return;
  }

  if (user.pw && user.pw !== pw) { toast('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤','error'); return; }
  if (user.status === 'pending') { toast('ê´€ë¦¬ì ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤','warning'); return; }
  if (user.status === 'rejected') { toast('ê°€ì…ì´ ê±°ì ˆëœ ê³„ì •ì…ë‹ˆë‹¤','error'); return; }
  completeLogin(user);
}

function doEmailLogin() {
  const email = document.getElementById('login-email').value.trim();
  const pw = document.getElementById('login-pw').value;
  if (!email || !pw) { toast('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”','error'); return; }

  const user = DB.users().find(u => (u.email === email || u.id === email) && u.pw === pw);
  if (!user) { toast('ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤','error'); return; }
  if (user.status === 'pending') { toast('ê´€ë¦¬ì ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤','warning'); return; }
  if (user.status === 'rejected') { toast('ê°€ì…ì´ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤','error'); return; }
  completeLogin(user);
}

function doSignup() {
  const name = document.getElementById('signup-name').value.trim();
  const email = document.getElementById('signup-email').value.trim();
  const pw = document.getElementById('signup-pw').value;
  if (!name||!email) { toast('ì´ë¦„ê³¼ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”','error'); return; }
  const users = DB.users();
  if (users.find(u=>u.email===email)) { toast('ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤','warning'); return; }
  const nu = { id:'u_'+Date.now(), email, name, role:'user', status:'pending', provider:'direct', pw, creditTotal:0, creditUsed:0, creditPending:0, createdAt:now() };
  users.push(nu); DB.saveUsers(users);
  DB.log(`ê°€ì… ì‹ ì²­: ${email}`);
  toast('ê°€ì… ì‹ ì²­ ì™„ë£Œ! ê´€ë¦¬ì ìŠ¹ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤','warning');
}

function completeLogin(user) {
  ME = user;
  DB.set('session', user.id);
  DB.log(`ë¡œê·¸ì¸: ${user.name}`, user.id);
  document.getElementById('login-page').style.display = 'none';
  document.getElementById('app').style.display = 'flex';
  initApp();
  toast(`ì–´ì„œì˜¤ì„¸ìš”, ${user.name}ë‹˜! ğŸ²`,'success');
}

function logout() {
  if (ME) DB.log(`ë¡œê·¸ì•„ì›ƒ: ${ME.name}`, ME.id);
  ME = null; DB.set('session', null);
  document.getElementById('app').style.display = 'none';
  document.getElementById('login-page').style.display = 'block';
  hideSSOSim();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   APP INIT & NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initApp() {
  refreshMe();
  buildBottomNav();
  goHome();
}

function refreshMe() {
  const u = DB.users().find(u=>u.id===ME.id);
  if (u) ME = u;
  document.getElementById('hdr-name').textContent = ME.name;
  const avail = Math.max(0, ME.creditTotal - ME.creditUsed - ME.creditPending);
  document.getElementById('hdr-credit').textContent = 'â‚©'+fmt(avail);
}

const USER_NAVS = [
  { id:'dashboard', icon:'ğŸ ', label:'í™ˆ' },
  { id:'apply', icon:'âœï¸', label:'ì‹ ì²­' },
  { id:'myapps', icon:'ğŸ“‹', label:'ë‚´ì—­' },
];
const ADMIN_NAVS = [
  { id:'admin', icon:'ğŸ“Š', label:'ëŒ€ì‹œë³´ë“œ' },
  { id:'admin-all', icon:'ğŸ“‚', label:'ì‹ ì²­ëª©ë¡' },
  { id:'admin-members', icon:'ğŸ‘¥', label:'íšŒì›' },
  { id:'admin-logs', icon:'ğŸ“œ', label:'ë¡œê·¸' },
];

function buildBottomNav() {
  const navs = ME.role === 'admin' ? ADMIN_NAVS : USER_NAVS;
  document.getElementById('bottom-nav').innerHTML = navs.map(n=>`
    <button class="bottom-nav-item" id="nav-${n.id}" onclick="navigateTo('${n.id}')">
      <span class="nav-icon">${n.icon}</span><span>${n.label}</span>
    </button>`).join('');
}

function goHome() {
  navigateTo(ME.role === 'admin' ? 'admin' : 'dashboard');
}

let currentPage = '';
function navigateTo(page) {
  currentPage = page;
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.bottom-nav-item').forEach(n=>n.classList.remove('active'));
  const p = document.getElementById('page-'+page);
  if (p) p.classList.add('active');
  const n = document.getElementById('nav-'+page);
  if (n) n.classList.add('active');
  document.getElementById('floating-bar').style.display = page==='apply' ? 'flex' : 'none';
  document.querySelector('.app-body').scrollTop = 0;

  switch(page) {
    case 'dashboard': renderDashboard(); break;
    case 'apply': initApply(); break;
    case 'myapps': renderMyApps(); break;
    case 'admin': renderAdminDash(); break;
    case 'admin-all': renderAdminAll(); break;
    case 'admin-members': renderAdminMembers(); break;
    case 'admin-logs': renderLogs(); break;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DASHBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderDashboard() {
  refreshMe();
  const avail = Math.max(0, ME.creditTotal - ME.creditUsed - ME.creditPending);
  const pct = ME.creditTotal > 0 ? Math.min(100, (ME.creditUsed + ME.creditPending) / ME.creditTotal * 100) : 0;

  const hour = new Date().getHours();
  const greeting = hour < 12 ? 'ì¢‹ì€ ì•„ì¹¨ì´ì—ìš”' : hour < 17 ? 'ì•ˆë…•í•˜ì„¸ìš”' : 'ìˆ˜ê³ í•˜ì…¨ì–´ìš”';
  document.getElementById('dash-greeting').textContent = `${greeting}, ${ME.name}ë‹˜ ğŸ‘‹`;

  document.getElementById('dash-stats').innerHTML = `
    <div class="stat-card"><div class="stat-label">ì´ ì§€ì› í¬ë ˆë”§</div><div class="stat-value blue">â‚©${fmt(ME.creditTotal)}</div></div>
    <div class="stat-card">
      <div class="stat-label">ì‚¬ìš© ê°€ëŠ¥</div>
      <div class="stat-value accent">â‚©${fmt(avail)}</div>
      <div class="credit-bar-bg"><div class="credit-bar-fill" style="width:${pct}%"></div></div>
    </div>
    <div class="stat-card"><div class="stat-label">ìŠ¹ì¸ ì™„ë£Œ</div><div class="stat-value green">â‚©${fmt(ME.creditUsed)}</div></div>
    <div class="stat-card"><div class="stat-label">ìŠ¹ì¸ ëŒ€ê¸°</div><div class="stat-value warn">â‚©${fmt(ME.creditPending)}</div></div>
  `;

  const myApps = DB.apps().filter(a=>a.applicantId===ME.id).slice(0,5);
  if (myApps.length === 0) {
    document.getElementById('dash-recent').innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ“­</div><div>ì‹ ì²­ ë‚´ì—­ì´ ì—†ì–´ìš”</div></div>`;
  } else {
    document.getElementById('dash-recent').innerHTML = myApps.map(a=>appListItem(a, false)).join('');
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   APPLY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let entries = [];

function initApply() {
  refreshMe();
  const avail = Math.max(0, ME.creditTotal - ME.creditUsed - ME.creditPending);
  document.getElementById('apply-credit-card').innerHTML = `
    <div class="card-title">ğŸ’° ë‚´ í¬ë ˆë”§ í˜„í™©</div>
    <div class="amount-display">
      <div><div class="label">ì‚¬ìš© ê°€ëŠ¥ í¬ë ˆë”§</div><div class="value">â‚©${fmt(avail)}</div></div>
      <div style="font-size:0.8rem;opacity:0.8;">ì´ â‚©${fmt(ME.creditTotal)}<br>ì‚¬ìš© â‚©${fmt(ME.creditUsed+ME.creditPending)}</div>
    </div>
  `;
  if (entries.length === 0) addAppEntry();
  else renderEntries();
}

function addAppEntry() {
  entries.push({
    id: Date.now(),
    date: todayStr(),
    category: '',
    description: '',
    receiptDataUrl: null,
    receiptName: null,
    participants: [{ userId: ME.id, name: ME.name, amount: '' }]
  });
  renderEntries();
}

function removeEntry(idx) {
  entries.splice(idx, 1);
  if (entries.length === 0) addAppEntry();
  else renderEntries();
}

function addParticipant(idx) {
  entries[idx].participants.push({ userId:'', name:'', amount:'' });
  renderEntries();
}

function removeParticipant(eIdx, pIdx) {
  entries[eIdx].participants.splice(pIdx, 1);
  renderEntries();
}

function renderEntries() {
  const approvedUsers = DB.users().filter(u=>u.role==='user'&&u.status==='approved'&&u.id!==ME.id);
  const container = document.getElementById('app-entries');
  container.innerHTML = '';

  entries.forEach((e, ei) => {
    const entryTotal = e.participants.reduce((s,p)=>s+(parseFloat(p.amount)||0),0);
    const catBtns = ['boardgame','escape','etc'].map(c=>{
      const labels = {boardgame:'ğŸ² ë³´ë“œê²Œì„', escape:'ğŸ” ë°©íƒˆì¶œ', etc:'ğŸ“¦ ê¸°íƒ€'};
      return `<button class="pill-opt ${e.category===c?'selected':''}" onclick="setEntryField(${ei},'category','${c}')">${labels[c]}</button>`;
    }).join('');

    const participantBlocks = e.participants.map((p, pi) => {
      const isSelf = pi === 0;
      const nameField = isSelf
        ? `<div style="font-size:0.88rem;font-weight:600;padding:9px 0;">${p.name}</div>`
        : `<select class="form-select" onchange="setParticipant(${ei},${pi},'userId',this.value)" style="font-size:0.85rem;">
            <option value="">íšŒì› ì„ íƒ (ê°€ì…íšŒì›ë§Œ)</option>
            ${approvedUsers.map(u=>`<option value="${u.id}" ${p.userId===u.id?'selected':''}>${u.name} (${u.email})</option>`).join('')}
           </select>`;
      return `<div class="participant-block">
        <div class="participant-header">
          <span class="participant-label">${isSelf ? 'ğŸ‘¤ ë³¸ì¸' : `ğŸ‘¥ ê³µë™ì´ìš©ì ${pi}`}</span>
          ${!isSelf ? `<button class="btn btn-ghost btn-xs" onclick="removeParticipant(${ei},${pi})">âœ• ì œê±°</button>` : ''}
        </div>
        ${nameField}
        <div class="form-group" style="margin-bottom:0;">
          <label class="form-label">ì‹ ì²­ê¸ˆì•¡ (ì›)</label>
          <input class="form-input" type="number" placeholder="0" value="${p.amount}"
            oninput="setParticipant(${ei},${pi},'amount',this.value)" style="font-size:0.95rem;">
        </div>
      </div>`;
    }).join('');

    const receiptHtml = e.receiptDataUrl
      ? `<div class="receipt-zone has-file" onclick="triggerReceipt(${ei})">
          <div style="font-size:0.82rem;color:var(--success);font-weight:600;">âœ… ì˜ìˆ˜ì¦ ì²¨ë¶€ ì™„ë£Œ</div>
          <img src="${e.receiptDataUrl}" alt="ì˜ìˆ˜ì¦">
          <button class="receipt-remove" onclick="removeReceipt(event,${ei})">âœ•</button>
         </div>`
      : `<div class="receipt-zone" onclick="triggerReceipt(${ei})">
          <div style="font-size:1.5rem;margin-bottom:6px;">ğŸ“</div>
          <div style="font-size:0.88rem;font-weight:600;color:var(--primary);">ì˜ìˆ˜ì¦ ì‚¬ì§„ ì²¨ë¶€ <span style="color:var(--danger);">*í•„ìˆ˜</span></div>
          <div style="font-size:0.78rem;color:var(--text-muted);margin-top:4px;">í´ë¦­í•˜ì—¬ ì‚¬ì§„ ì„ íƒ (JPG, PNG)</div>
         </div>`;

    const card = document.createElement('div');
    card.className = 'entry-card';
    card.innerHTML = `
      <div class="entry-card-header">
        <div class="entry-card-title"><span class="entry-num">${ei+1}</span> ì‹ ì²­ í•­ëª©</div>
        ${entries.length > 1 ? `<button class="btn btn-ghost btn-xs" onclick="removeEntry(${ei})">ğŸ—‘ ì‚­ì œ</button>` : ''}
      </div>
      <div class="form-group">
        <label class="form-label">ì¼ì<span class="req">*</span></label>
        <input class="form-input" type="date" value="${e.date}" onchange="setEntryField(${ei},'date',this.value)">
      </div>
      <div class="form-group">
        <label class="form-label">ì‹ ì²­êµ¬ë¶„<span class="req">*</span></label>
        <div class="pill-select-row">${catBtns}</div>
      </div>
      <div class="form-group">
        <label class="form-label">ì´ìš©ë‚´ìš©<span class="req">*</span></label>
        <input class="form-input" type="text" placeholder="ì˜ˆ: ë³´ë“œê²Œì„ì¹´í˜ 2ì¸ ì…ì¥" value="${e.description||''}" onchange="setEntryField(${ei},'description',this.value)">
      </div>
      ${participantBlocks}
      <button class="btn btn-outline btn-sm btn-full mt-2" onclick="addParticipant(${ei})">
        ï¼‹ ê³µë™ì´ìš©ì ì¶”ê°€
      </button>
      <div class="entry-total">
        <span class="label">í•­ëª© í•©ê³„</span>
        <span class="value">â‚©${fmt(entryTotal)}</span>
      </div>
      <div class="form-group mt-2">
        <label class="form-label">ì˜ìˆ˜ì¦<span class="req">*</span></label>
        ${receiptHtml}
        <input type="file" accept="image/*" id="file-${ei}" style="display:none" onchange="handleReceipt(${ei},this)">
      </div>
    `;
    container.appendChild(card);
  });

  updateFloatingTotal();
}

function setEntryField(idx, field, val) {
  entries[idx][field] = val;
  if (field === 'category') renderEntries();
  else updateFloatingTotal();
}

function setParticipant(eIdx, pIdx, field, val) {
  if (field === 'userId') {
    const u = DB.users().find(u=>u.id===val);
    entries[eIdx].participants[pIdx].userId = val;
    entries[eIdx].participants[pIdx].name = u ? u.name : '';
  } else {
    entries[eIdx].participants[pIdx][field] = val;
  }
  updateFloatingTotal();
  // update entry total display
  const cards = document.querySelectorAll('.entry-card');
  if (cards[eIdx]) {
    const total = entries[eIdx].participants.reduce((s,p)=>s+(parseFloat(p.amount)||0),0);
    const tv = cards[eIdx].querySelector('.entry-total .value');
    if (tv) tv.textContent = 'â‚©'+fmt(total);
  }
}

function updateFloatingTotal() {
  const total = entries.reduce((s,e)=>s+e.participants.reduce((ss,p)=>ss+(parseFloat(p.amount)||0),0),0);
  document.getElementById('float-total').textContent = 'â‚©'+fmt(total);
}

function triggerReceipt(idx) { document.getElementById('file-'+idx).click(); }
function removeReceipt(event, idx) {
  event.stopPropagation();
  entries[idx].receiptDataUrl = null; entries[idx].receiptName = null;
  renderEntries();
}
function handleReceipt(idx, input) {
  const file = input.files[0]; if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    entries[idx].receiptDataUrl = e.target.result;
    entries[idx].receiptName = file.name;
    renderEntries();
    toast('ì˜ìˆ˜ì¦ì´ ì²¨ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤ âœ…','success');
  };
  reader.readAsDataURL(file);
}

function submitApplication() {
  // Validate entries
  for (let i=0; i<entries.length; i++) {
    const e = entries[i];
    if (!e.date) { toast(`í•­ëª© ${i+1}: ì¼ìë¥¼ ì„ íƒí•˜ì„¸ìš”`,'error'); return; }
    if (!e.category) { toast(`í•­ëª© ${i+1}: ì‹ ì²­êµ¬ë¶„ì„ ì„ íƒí•˜ì„¸ìš”`,'error'); return; }
    if (!e.description.trim()) { toast(`í•­ëª© ${i+1}: ì´ìš©ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”`,'error'); return; }
    if (!e.receiptDataUrl) { toast(`í•­ëª© ${i+1}: ì˜ìˆ˜ì¦ì„ ì²¨ë¶€í•˜ì„¸ìš”`,'error'); return; }
    for (let j=1; j<e.participants.length; j++) {
      if (!e.participants[j].userId) { toast(`í•­ëª© ${i+1}: ê³µë™ì´ìš©ì íšŒì›ì„ ì„ íƒí•˜ì„¸ìš”`,'error'); return; }
    }
    const total = e.participants.reduce((s,p)=>s+(parseFloat(p.amount)||0),0);
    if (total <= 0) { toast(`í•­ëª© ${i+1}: ì‹ ì²­ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”`,'error'); return; }
  }

  const acname = document.getElementById('apply-acname').value.trim();
  const bank = document.getElementById('apply-bank').value;
  const acnum = document.getElementById('apply-acnum').value.trim();
  if (!acname||!bank||!acnum) { toast('í™˜ê¸‰ ê³„ì¢Œ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”','error'); return; }

  // Credit check per user
  const users = DB.users();
  const creditMap = {}; // userId -> total requested in this submission
  for (let e of entries) {
    for (let p of e.participants) {
      const amt = parseFloat(p.amount)||0;
      if (!p.userId || amt<=0) continue;
      creditMap[p.userId] = (creditMap[p.userId]||0) + amt;
    }
  }
  for (let [uid, requested] of Object.entries(creditMap)) {
    const u = users.find(u=>u.id===uid);
    if (!u) continue;
    const avail = Math.max(0, u.creditTotal - u.creditUsed - u.creditPending);
    if (requested > avail) {
      toast(`${u.name}ë‹˜ í¬ë ˆë”§ ë¶€ì¡± (ê°€ëŠ¥: â‚©${fmt(avail)}, ìš”ì²­: â‚©${fmt(requested)})`,'error');
      return;
    }
  }

  // Create app record
  const app = {
    id: 'app_'+Date.now(),
    applicantId: ME.id,
    applicantName: ME.name,
    status: 'pending',
    createdAt: now(),
    updatedAt: now(),
    bankName: bank, accountName: acname, accountNum: acnum,
    note: document.getElementById('apply-note').value,
    entries: entries.map(e=>({ ...e, totalAmount: e.participants.reduce((s,p)=>s+(parseFloat(p.amount)||0),0) })),
    totalAmount: entries.reduce((s,e)=>s+e.participants.reduce((ss,p)=>ss+(parseFloat(p.amount)||0),0),0)
  };

  // Mark pending credits
  for (let [uid, amt] of Object.entries(creditMap)) {
    const idx = users.findIndex(u=>u.id===uid);
    if (idx!==-1) users[idx].creditPending += amt;
  }
  DB.saveUsers(users);

  const apps = DB.apps(); apps.push(app); DB.saveApps(apps);
  DB.log(`ì‹ ì²­ ì œì¶œ: ${app.id} â‚©${fmt(app.totalAmount)}`, ME.id);
  toast('âœ… ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!','success');

  entries = []; clearApplyForm();
  refreshMe();
  navigateTo('myapps');
}

function clearApplyForm() {
  ['apply-acname','apply-bank','apply-acnum','apply-note'].forEach(id=>{
    const el = document.getElementById(id);
    if (el) el.value = '';
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MY APPS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderMyApps() {
  refreshMe();
  const myApps = DB.apps().filter(a=>a.applicantId===ME.id).sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt));
  const container = document.getElementById('myapps-list');
  if (myApps.length===0) {
    container.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ“­</div><div>ì‹ ì²­ ë‚´ì—­ì´ ì—†ì–´ìš”</div><button class="btn btn-accent mt-2" onclick="navigateTo('apply')">ì‹ ì²­í•˜ê¸°</button></div>`;
    return;
  }
  container.innerHTML = myApps.map(a=>appListItem(a, true)).join('');
}

function appListItem(a, showActions=true) {
  return `<div class="app-list-item" onclick="openDetail('${a.id}')">
    <div class="app-list-row">
      <div class="app-list-name">${a.applicantName} Â· ${a.entries?a.entries.length:0}ê±´</div>
      <div>${statusBadge(a.status)}</div>
    </div>
    <div class="app-list-row">
      <div class="app-list-amount">â‚©${fmt(a.totalAmount)}</div>
      <div class="app-list-date">${fmtDate(a.createdAt)}</div>
    </div>
    <div class="app-list-meta">${a.entries?a.entries.map(e=>catLabel(e.category)).join(', '):''}</div>
    ${showActions && a.status==='pending' ? `<div class="app-list-actions" onclick="event.stopPropagation()">
      <button class="btn btn-ghost btn-xs" onclick="cancelApp('${a.id}')">ğŸš« ì·¨ì†Œ</button>
    </div>` : ''}
  </div>`;
}

function cancelApp(id) {
  if (!confirm('ì‹ ì²­ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  const apps = DB.apps();
  const idx = apps.findIndex(a=>a.id===id); if (idx===-1) return;
  if (apps[idx].status!=='pending') { toast('ëŒ€ê¸° ì¤‘ì¸ ì‹ ì²­ë§Œ ì·¨ì†Œ ê°€ëŠ¥í•©ë‹ˆë‹¤','error'); return; }
  apps[idx].status = 'cancelled'; apps[idx].updatedAt = now();
  DB.saveApps(apps);
  restorePending(apps[idx]);
  DB.log(`ì‹ ì²­ ì·¨ì†Œ: ${id}`, ME.id);
  toast('ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤','success');
  refreshMe(); renderMyApps();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DETAIL MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let detailAppId = '';
function openDetail(id, isAdmin=false) {
  detailAppId = id;
  const app = DB.apps().find(a=>a.id===id); if (!app) return;
  const isAdminView = isAdmin || ME.role==='admin';

  document.getElementById('modal-detail-title').textContent = `ğŸ“„ ì‹ ì²­ ìƒì„¸ â€” ${fmtDate(app.createdAt)}`;

  const entriesHtml = (app.entries||[]).map((e,i)=>`
    <div style="background:var(--surface2);border-radius:10px;padding:12px;margin-bottom:10px;border:1px solid var(--border);">
      <div style="font-weight:700;color:var(--primary-dark);margin-bottom:8px;">
        ${catLabel(e.category)} Â· ${e.date} Â· <span style="color:var(--primary);">â‚©${fmt(e.totalAmount)}</span>
      </div>
      <div style="font-size:0.88rem;margin-bottom:8px;color:var(--text);">${e.description}</div>
      ${(e.participants||[]).map(p=>`
        <div style="display:flex;justify-content:space-between;font-size:0.85rem;padding:4px 0;border-bottom:1px dashed var(--border);">
          <span>${p.name||'(ë¯¸ì„ íƒ)'}</span><span style="font-weight:700;">â‚©${fmt(p.amount)}</span>
        </div>`).join('')}
      ${e.receiptDataUrl ? `<img src="${e.receiptDataUrl}" style="max-width:100%;border-radius:8px;margin-top:10px;" alt="ì˜ìˆ˜ì¦">` : ''}
    </div>
  `).join('');

  document.getElementById('modal-detail-body').innerHTML = `
    <div class="detail-section">
      <div class="detail-row"><span class="detail-key">ì‹ ì²­ì</span><span class="detail-val">${app.applicantName}</span></div>
      <div class="detail-row"><span class="detail-key">ìƒíƒœ</span><span class="detail-val">${statusBadge(app.status)}</span></div>
      <div class="detail-row"><span class="detail-key">ì‹ ì²­ì¼</span><span class="detail-val">${fmtDate(app.createdAt,true)}</span></div>
      ${app.approvedAt ? `<div class="detail-row"><span class="detail-key">ì²˜ë¦¬ì¼</span><span class="detail-val">${fmtDate(app.approvedAt,true)}</span></div>` : ''}
      <div class="detail-row"><span class="detail-key">í™˜ê¸‰ê³„ì¢Œ</span><span class="detail-val">${app.bankName} ${app.accountNum}<br>(${app.accountName})</span></div>
      ${app.note ? `<div class="detail-row"><span class="detail-key">ë¹„ê³ </span><span class="detail-val">${app.note}</span></div>` : ''}
      ${app.adminNote ? `<div class="detail-row"><span class="detail-key">ê´€ë¦¬ìë©”ëª¨</span><span class="detail-val" style="color:var(--primary);">${app.adminNote}</span></div>` : ''}
    </div>
    <div class="section-divider"></div>
    <div class="card-title" style="margin-bottom:10px;">ì‹ ì²­ í•­ëª©</div>
    ${entriesHtml}
    <div class="amount-display mt-2">
      <div><div class="label">ì´ ì‹ ì²­ê¸ˆì•¡</div><div class="value">â‚©${fmt(app.totalAmount)}</div></div>
      <div style="font-size:0.8rem;opacity:0.8;">${(app.entries||[]).length}ê°œ í•­ëª©</div>
    </div>
  `;

  let actions = `<button class="btn btn-outline" onclick="closeModal('modal-detail')">ë‹«ê¸°</button>`;
  if (isAdminView) {
    actions += `
      <button class="btn btn-info" onclick="openPrintPreview('${id}')">ğŸ–¨ï¸ ì¸ì‡„</button>
      <button class="btn btn-warn btn-sm" onclick="openEdit('${id}')">âœï¸ ìˆ˜ì •</button>
    `;
    if (app.status === 'pending') {
      actions += `
        <button class="btn btn-success" onclick="approveApp('${id}')">âœ… ìŠ¹ì¸</button>
        <button class="btn btn-danger" onclick="rejectApp('${id}')">âŒ ë°˜ë ¤</button>
      `;
    }
  } else if (app.status === 'pending') {
    actions += `<button class="btn btn-danger" onclick="cancelApp('${id}')">ì·¨ì†Œ</button>`;
  }
  document.getElementById('modal-detail-actions').innerHTML = actions;
  openModal('modal-detail');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN DASHBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderAdminDash() {
  const apps = DB.apps();
  const users = DB.users().filter(u=>u.role==='user');
  const pending = apps.filter(a=>a.status==='pending');
  const approved = apps.filter(a=>a.status==='approved'||a.status==='mod-approved');
  const totalPaid = approved.reduce((s,a)=>s+a.totalAmount,0);

  document.getElementById('admin-stats').innerHTML = `
    <div class="stat-card"><div class="stat-label">ì „ì²´ íšŒì›</div><div class="stat-value blue">${users.length}ëª…</div></div>
    <div class="stat-card"><div class="stat-label">ìŠ¹ì¸ ëŒ€ê¸°</div><div class="stat-value accent">${pending.length}ê±´ <span class="pending-dot"></span></div></div>
    <div class="stat-card"><div class="stat-label">ì „ì²´ ì‹ ì²­</div><div class="stat-value">${apps.length}ê±´</div></div>
    <div class="stat-card"><div class="stat-label">ì´ ì§€ê¸‰ì•¡</div><div class="stat-value green">â‚©${fmt(totalPaid)}</div></div>
  `;

  const el = document.getElementById('admin-pending');
  if (pending.length===0) {
    el.innerHTML = `<div class="empty-state"><div class="empty-icon">âœ…</div><div>ëŒ€ê¸° ì¤‘ì¸ ì‹ ì²­ ì—†ìŒ</div></div>`;
    return;
  }
  el.innerHTML = pending.sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt)).map(a=>`
    <div class="app-list-item" onclick="openDetail('${a.id}',true)">
      <div class="app-list-row">
        <div class="app-list-name">${a.applicantName}</div>
        <div>${statusBadge(a.status)}</div>
      </div>
      <div class="app-list-row">
        <div class="app-list-amount">â‚©${fmt(a.totalAmount)}</div>
        <div class="app-list-date">${fmtDate(a.createdAt)}</div>
      </div>
      <div class="app-list-meta">${a.entries?a.entries.map(e=>catLabel(e.category)).join(', '):''}</div>
      <div class="app-list-actions" onclick="event.stopPropagation()">
        <button class="btn btn-success btn-xs" onclick="approveApp('${a.id}')">âœ… ìŠ¹ì¸</button>
        <button class="btn btn-warn btn-xs" onclick="openEdit('${a.id}')">âœï¸</button>
        <button class="btn btn-danger btn-xs" onclick="rejectApp('${a.id}')">âŒ ë°˜ë ¤</button>
        <button class="btn btn-info btn-xs" onclick="openPrintPreview('${a.id}')">ğŸ–¨ï¸</button>
      </div>
    </div>
  `).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN ALL APPS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderAdminAll() {
  let apps = DB.apps();
  const search = (document.getElementById('admin-search')?.value||'').toLowerCase();
  const sf = document.getElementById('admin-status-filter')?.value||'';
  if (search) apps = apps.filter(a=> a.applicantName.toLowerCase().includes(search)||a.id.includes(search)||(a.note||'').toLowerCase().includes(search));
  if (sf) apps = apps.filter(a=>a.status===sf);
  apps.sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt));

  document.getElementById('admin-all-count').textContent = `ì´ ${apps.length}ê±´`;
  const el = document.getElementById('admin-all-list');
  if (apps.length===0) { el.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ”</div><div>ê²°ê³¼ ì—†ìŒ</div></div>`; return; }
  el.innerHTML = apps.map(a=>`
    <div class="app-list-item" onclick="openDetail('${a.id}',true)">
      <div class="app-list-row">
        <div class="app-list-name">${a.applicantName}</div>
        <div>${statusBadge(a.status)}</div>
      </div>
      <div class="app-list-row">
        <div class="app-list-amount">â‚©${fmt(a.totalAmount)}</div>
        <div class="app-list-date">${fmtDate(a.createdAt)}</div>
      </div>
      <div class="app-list-meta">${a.entries?a.entries.map(e=>catLabel(e.category)).join(', '):''}</div>
      <div class="app-list-actions" onclick="event.stopPropagation()">
        ${a.status==='pending'?`<button class="btn btn-success btn-xs" onclick="approveApp('${a.id}')">âœ…</button>`:''}
        <button class="btn btn-warn btn-xs" onclick="openEdit('${a.id}')">âœï¸</button>
        ${a.status==='pending'?`<button class="btn btn-danger btn-xs" onclick="rejectApp('${a.id}')">âŒ</button>`:''}
        <button class="btn btn-info btn-xs" onclick="openPrintPreview('${a.id}')">ğŸ–¨ï¸</button>
      </div>
    </div>
  `).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN APPROVE / REJECT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function approveApp(id) {
  if (!confirm('ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  const apps = DB.apps();
  const idx = apps.findIndex(a=>a.id===id); if (idx===-1) return;
  const app = apps[idx];
  const prevStatus = app.status;
  apps[idx].status = prevStatus==='pending'?'approved':'mod-approved';
  apps[idx].updatedAt = now();
  apps[idx].approvedAt = now();
  apps[idx].approvedBy = ME.id;
  DB.saveApps(apps);

  const users = DB.users();
  for (let e of (app.entries||[])) {
    for (let p of e.participants) {
      const amt = parseFloat(p.amount)||0;
      if (!p.userId||amt<=0) continue;
      const ui = users.findIndex(u=>u.id===p.userId);
      if (ui!==-1) { users[ui].creditPending=Math.max(0,users[ui].creditPending-amt); users[ui].creditUsed+=amt; }
    }
  }
  DB.saveUsers(users);
  DB.log(`ìŠ¹ì¸: ${id} â‚©${fmt(app.totalAmount)}`, ME.id);
  toast('âœ… ìŠ¹ì¸ ì™„ë£Œ','success');
  closeModal('modal-detail');
  refreshMe();
  if (currentPage==='admin') renderAdminDash();
  else if (currentPage==='admin-all') renderAdminAll();
}

function rejectApp(id) {
  if (!confirm('ë°˜ë ¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  const apps = DB.apps();
  const idx = apps.findIndex(a=>a.id===id); if (idx===-1) return;
  apps[idx].status = 'rejected'; apps[idx].updatedAt = now();
  DB.saveApps(apps);
  restorePending(apps[idx]);
  DB.log(`ë°˜ë ¤: ${id}`, ME.id);
  toast('ë°˜ë ¤ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤','warning');
  closeModal('modal-detail');
  refreshMe();
  if (currentPage==='admin') renderAdminDash();
  else if (currentPage==='admin-all') renderAdminAll();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN EDIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let editId = '';
function openEdit(id) {
  editId = id;
  const app = DB.apps().find(a=>a.id===id); if (!app) return;

  const entriesHtml = (app.entries||[]).map((e,i)=>`
    <div style="background:var(--surface2);border-radius:10px;padding:12px;margin-bottom:10px;border:1px solid var(--border);">
      <div style="font-weight:700;font-size:0.9rem;margin-bottom:10px;">í•­ëª© ${i+1}</div>
      <div class="form-row-2">
        <div class="form-group"><label class="form-label">ì¼ì</label><input class="form-input" type="date" id="ed-date-${i}" value="${e.date}"></div>
        <div class="form-group"><label class="form-label">êµ¬ë¶„</label>
          <select class="form-select" id="ed-cat-${i}">
            <option value="boardgame" ${e.category==='boardgame'?'selected':''}>ë³´ë“œê²Œì„</option>
            <option value="escape" ${e.category==='escape'?'selected':''}>ë°©íƒˆì¶œ</option>
            <option value="etc" ${e.category==='etc'?'selected':''}>ê¸°íƒ€</option>
          </select>
        </div>
      </div>
      <div class="form-group"><label class="form-label">ì´ìš©ë‚´ìš©</label><input class="form-input" type="text" id="ed-desc-${i}" value="${e.description}"></div>
      ${(e.participants||[]).map((p,pi)=>`
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;">
          <span style="flex:1;font-size:0.83rem;color:var(--text-muted);">${p.name||'?'}</span>
          <div style="flex:1;"><input class="form-input" type="number" id="ed-amt-${i}-${pi}" value="${p.amount}" style="font-size:0.88rem;"></div>
        </div>`).join('')}
    </div>
  `).join('');

  document.getElementById('modal-edit-body').innerHTML = `
    <div class="form-row-2">
      <div class="form-group"><label class="form-label">ì€í–‰</label><input class="form-input" id="ed-bank" value="${app.bankName}"></div>
      <div class="form-group"><label class="form-label">ì˜ˆê¸ˆì£¼</label><input class="form-input" id="ed-acname" value="${app.accountName}"></div>
    </div>
    <div class="form-group"><label class="form-label">ê³„ì¢Œë²ˆí˜¸</label><input class="form-input" id="ed-acnum" value="${app.accountNum}"></div>
    <div class="form-group"><label class="form-label">ê´€ë¦¬ì ë©”ëª¨</label><textarea class="form-textarea" id="ed-note">${app.adminNote||''}</textarea></div>
    <div class="section-divider"></div>
    ${entriesHtml}
  `;

  document.getElementById('modal-edit-actions').innerHTML = `
    <button class="btn btn-outline" onclick="closeModal('modal-edit')">ì·¨ì†Œ</button>
    <button class="btn btn-warn btn-sm" onclick="saveEdit(false)">ìˆ˜ì • ì €ì¥</button>
    <button class="btn btn-success btn-sm" onclick="saveEdit(true)">ìˆ˜ì • í›„ ìŠ¹ì¸</button>
  `;
  closeModal('modal-detail');
  openModal('modal-edit');
}

function saveEdit(andApprove) {
  const apps = DB.apps();
  const idx = apps.findIndex(a=>a.id===editId); if (idx===-1) return;
  const app = apps[idx];

  app.bankName = document.getElementById('ed-bank').value;
  app.accountName = document.getElementById('ed-acname').value;
  app.accountNum = document.getElementById('ed-acnum').value;
  app.adminNote = document.getElementById('ed-note').value;

  let newTotal = 0;
  app.entries.forEach((e,i)=>{
    e.date = document.getElementById(`ed-date-${i}`)?.value||e.date;
    e.category = document.getElementById(`ed-cat-${i}`)?.value||e.category;
    e.description = document.getElementById(`ed-desc-${i}`)?.value||e.description;
    e.participants.forEach((p,pi)=>{
      const inp = document.getElementById(`ed-amt-${i}-${pi}`);
      if (!inp) return;
      const newAmt = parseFloat(inp.value)||0;
      if (app.status==='pending') {
        const diff = newAmt - (parseFloat(p.amount)||0);
        if (p.userId && diff!==0) {
          const users = DB.users();
          const ui = users.findIndex(u=>u.id===p.userId);
          if (ui!==-1) { users[ui].creditPending = Math.max(0, users[ui].creditPending+diff); DB.saveUsers(users); }
        }
      }
      p.amount = newAmt;
    });
    e.totalAmount = e.participants.reduce((s,p)=>s+(parseFloat(p.amount)||0),0);
    newTotal += e.totalAmount;
  });
  app.totalAmount = newTotal;
  app.updatedAt = now();

  if (andApprove) {
    app.status = 'mod-approved';
    app.approvedAt = now(); app.approvedBy = ME.id;
    const users = DB.users();
    for (let e of app.entries) for (let p of e.participants) {
      const amt = parseFloat(p.amount)||0;
      if (!p.userId||amt<=0) continue;
      const ui = users.findIndex(u=>u.id===p.userId);
      if (ui!==-1) { users[ui].creditPending=Math.max(0,users[ui].creditPending-amt); users[ui].creditUsed+=amt; }
    }
    DB.saveUsers(users);
  }

  apps[idx] = app; DB.saveApps(apps);
  DB.log(`ìˆ˜ì •${andApprove?'+ìŠ¹ì¸':''}: ${editId}`, ME.id);
  toast(andApprove?'âœ… ìˆ˜ì • í›„ ìŠ¹ì¸ ì™„ë£Œ':'âœï¸ ìˆ˜ì • ì™„ë£Œ','success');
  closeModal('modal-edit');
  refreshMe();
  if (currentPage==='admin') renderAdminDash();
  else if (currentPage==='admin-all') renderAdminAll();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN MEMBERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderAdminMembers() {
  const users = DB.users();
  const el = document.getElementById('admin-members-list');
  el.innerHTML = users.map(u=>{
    const avail = Math.max(0, u.creditTotal - u.creditUsed - u.creditPending);
    const statusIcon = u.status==='approved'?'âœ…':u.status==='pending'?'â³':'âŒ';
    return `<div class="card" style="margin-bottom:10px;">
      <div class="flex-between mb-2">
        <div>
          <div style="font-weight:700;font-size:0.95rem;">${u.name} ${u.role==='admin'?'<span class="admin-tag">ADMIN</span>':''}</div>
          <div style="font-size:0.78rem;color:var(--text-muted);">${u.email} Â· ${u.provider||'local'}</div>
        </div>
        <div>${statusIcon}</div>
      </div>
      <div class="stats-grid" style="grid-template-columns:repeat(3,1fr);gap:6px;margin-bottom:10px;">
        <div style="background:var(--surface2);border-radius:8px;padding:8px;text-align:center;">
          <div style="font-size:0.68rem;color:var(--text-muted);">ì´í¬ë ˆë”§</div>
          <div style="font-size:0.9rem;font-weight:700;color:var(--primary);">â‚©${fmt(u.creditTotal)}</div>
        </div>
        <div style="background:var(--surface2);border-radius:8px;padding:8px;text-align:center;">
          <div style="font-size:0.68rem;color:var(--text-muted);">ì‚¬ìš©</div>
          <div style="font-size:0.9rem;font-weight:700;color:var(--success);">â‚©${fmt(u.creditUsed)}</div>
        </div>
        <div style="background:var(--surface2);border-radius:8px;padding:8px;text-align:center;">
          <div style="font-size:0.68rem;color:var(--text-muted);">ê°€ìš©</div>
          <div style="font-size:0.9rem;font-weight:700;color:var(--accent);">â‚©${fmt(avail)}</div>
        </div>
      </div>
      <div class="btn-row">
        ${u.status==='pending'?`<button class="btn btn-success btn-sm" onclick="approveUser('${u.id}')">âœ… ìŠ¹ì¸</button>`:''}
        <button class="btn btn-outline btn-sm" onclick="openCreditEdit('${u.id}')">ğŸ’° í¬ë ˆë”§</button>
        ${u.status!=='rejected'&&u.role!=='admin'?`<button class="btn btn-danger btn-sm" onclick="rejectUser('${u.id}')">ê±°ì ˆ</button>`:''}
      </div>
    </div>`;
  }).join('');
}

function approveUser(uid) {
  const users = DB.users();
  const idx = users.findIndex(u=>u.id===uid); if (idx===-1) return;
  users[idx].status = 'approved';
  if (users[idx].creditTotal === 0) users[idx].creditTotal = 30000;
  DB.saveUsers(users);
  DB.log(`íšŒì› ìŠ¹ì¸: ${users[idx].email}`, ME.id);
  toast(`${users[idx].name} ìŠ¹ì¸ + í¬ë ˆë”§ â‚©30,000 ì§€ê¸‰`,'success');
  renderAdminMembers();
}

function rejectUser(uid) {
  const users = DB.users();
  const idx = users.findIndex(u=>u.id===uid); if (idx===-1) return;
  if (!confirm(`${users[idx].name}ì„ ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
  users[idx].status = 'rejected';
  DB.saveUsers(users);
  DB.log(`íšŒì› ê±°ì ˆ: ${users[idx].email}`, ME.id);
  toast('ê±°ì ˆ ì²˜ë¦¬','warning');
  renderAdminMembers();
}

let editCreditUid = '';
function openCreditEdit(uid) {
  editCreditUid = uid;
  const u = DB.users().find(u=>u.id===uid); if (!u) return;
  document.getElementById('modal-credit-body').innerHTML = `
    <div style="margin-bottom:12px;font-weight:700;">${u.name} (${u.email})</div>
    <div class="form-group"><label class="form-label">ì´ í¬ë ˆë”§ (ì›)</label><input class="form-input" type="number" id="cr-total" value="${u.creditTotal}"></div>
    <div class="form-group"><label class="form-label">ì‚¬ìš© í¬ë ˆë”§ (ê´€ë¦¬ì ì¡°ì •)</label><input class="form-input" type="number" id="cr-used" value="${u.creditUsed}"></div>
    <div class="text-muted">ëŒ€ê¸°: â‚©${fmt(u.creditPending)}</div>
  `;
  openModal('modal-credit');
}
function saveCreditEdit() {
  const users = DB.users();
  const idx = users.findIndex(u=>u.id===editCreditUid); if (idx===-1) return;
  users[idx].creditTotal = parseFloat(document.getElementById('cr-total').value)||0;
  users[idx].creditUsed = parseFloat(document.getElementById('cr-used').value)||0;
  DB.saveUsers(users);
  DB.log(`í¬ë ˆë”§ ìˆ˜ì •: ${users[idx].email}`, ME.id);
  toast('í¬ë ˆë”§ ìˆ˜ì • ì™„ë£Œ','success');
  closeModal('modal-credit');
  renderAdminMembers();
}

function openCreateUserModal() {
  ['nu-name','nu-email'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('nu-pw').value = '4321';
  document.getElementById('nu-credit').value = '30000';
  document.getElementById('nu-role').value = 'user';
  openModal('modal-create-user');
}
function createUser() {
  const name = document.getElementById('nu-name').value.trim();
  const email = document.getElementById('nu-email').value.trim();
  const pw = document.getElementById('nu-pw').value;
  const credit = parseFloat(document.getElementById('nu-credit').value)||0;
  const role = document.getElementById('nu-role').value;
  if (!name||!email) { toast('ì´ë¦„ê³¼ ì´ë©”ì¼ í•„ìˆ˜','error'); return; }
  const users = DB.users();
  if (users.find(u=>u.email===email)) { toast('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼','error'); return; }
  users.push({ id:'u_'+Date.now(), email, name, role, status:'approved', provider:'admin', pw, creditTotal:credit, creditUsed:0, creditPending:0, createdAt:now() });
  DB.saveUsers(users);
  DB.log(`ê³„ì • ìƒì„±: ${email}`, ME.id);
  toast(`${name} ê³„ì • ìƒì„± ì™„ë£Œ`,'success');
  closeModal('modal-create-user');
  renderAdminMembers();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderLogs() {
  const logs = DB.logs();
  const el = document.getElementById('logs-content');
  if (logs.length===0) { el.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ“‹</div><div>ë¡œê·¸ ì—†ìŒ</div></div>`; return; }
  el.innerHTML = logs.map(l=>`
    <div style="display:flex;gap:10px;padding:7px 0;border-bottom:1px solid var(--border);font-size:0.8rem;align-items:flex-start;">
      <div style="color:var(--text-muted);white-space:nowrap;min-width:100px;">${fmtDate(l.ts,true)}</div>
      <div style="flex:1;color:var(--text);">${l.msg}</div>
    </div>`).join('');
}

function clearLogs() {
  if (!confirm('ë¡œê·¸ë¥¼ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  DB.set('logs',[]);
  DB.log('ë¡œê·¸ ì´ˆê¸°í™”', ME.id);
  renderLogs();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PRINT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let printAppId = '';
function openPrintPreview(id) {
  printAppId = id;
  const app = DB.apps().find(a=>a.id===id); if (!app) return;

  const topRows = (app.entries||[]).map(e=>{
    const ps = (e.participants||[]).map(p=>`${p.name} â‚©${fmt(p.amount)}`).join(' / ');
    return `<tr>
      <td>${e.date}</td>
      <td>${catLabel(e.category)}</td>
      <td>${e.description}</td>
      <td>${ps}</td>
      <td style="text-align:right;font-weight:700;">â‚©${fmt(e.totalAmount)}</td>
    </tr>`;
  }).join('');

  const previewHtml = `
    <div style="font-family:'Noto Sans KR',sans-serif;font-size:11pt;color:#000;">
      <div style="background:#1e3a8a;color:#fff;padding:10px 14px;border-radius:4px;margin-bottom:8px;">
        <div style="font-size:13pt;font-weight:900;">2026 ë³´ë™ë³´ë™ ê°“ìƒì§€ì›ê¸ˆ ì‹ ì²­ì„œ</div>
        <div style="font-size:9pt;opacity:0.85;">ì§€ì›ê¸ˆ í™˜ê¸‰ ì‹ ì²­</div>
      </div>
      <div style="font-size:9pt;color:#888;margin-bottom:10px;">ì‹ ì²­ì¼: ${fmtDate(app.createdAt,true)} | ì‹ ì²­ë²ˆí˜¸: ${app.id}</div>
      <table class="print-table" style="width:100%;border-collapse:collapse;font-size:9pt;margin-bottom:10px;">
        <thead><tr style="background:#1e3a8a;color:#fff;">
          <th style="padding:6px 8px;">ì´ìš©ì¼ì</th>
          <th style="padding:6px 8px;">êµ¬ë¶„</th>
          <th style="padding:6px 8px;">ì´ìš©ë‚´ìš©</th>
          <th style="padding:6px 8px;">ì´ìš©ì(ê¸ˆì•¡)</th>
          <th style="padding:6px 8px;text-align:right;">ì‹ ì²­ê¸ˆì•¡</th>
        </tr></thead>
        <tbody>${topRows}</tbody>
      </table>
      <div style="border:2px solid #1e3a8a;border-radius:4px;padding:10px 14px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;">
        <span style="font-weight:700;color:#1e3a8a;">ì´ ì‹ ì²­ê¸ˆì•¡ (ì…ê¸ˆ í•„ìš” ê¸ˆì•¡)</span>
        <span style="font-size:14pt;font-weight:900;color:#1e3a8a;">â‚©${fmt(app.totalAmount)}</span>
      </div>
      <div style="border:1.5px solid #93C5FD;border-radius:4px;padding:10px 14px;background:#EFF6FF;">
        <div style="font-weight:700;color:#1e40af;margin-bottom:6px;">ğŸ’³ ì…ê¸ˆ ê³„ì¢Œ ì •ë³´</div>
        <div style="font-size:9.5pt;"><b>ì€í–‰:</b> ${app.bankName} &nbsp;|&nbsp; <b>ê³„ì¢Œë²ˆí˜¸:</b> ${app.accountNum} &nbsp;|&nbsp; <b>ì˜ˆê¸ˆì£¼:</b> ${app.accountName}</div>
      </div>
      ${app.note ? `<div style="margin-top:8px;font-size:9pt;color:#666;">ë¹„ê³ : ${app.note}</div>` : ''}
    </div>
  `;

  document.getElementById('modal-print-preview').innerHTML = previewHtml;
  openModal('modal-print');
}

function doPrint() {
  const app = DB.apps().find(a=>a.id===printAppId); if (!app) return;

  const topRows = (app.entries||[]).map(e=>{
    const ps = (e.participants||[]).map(p=>`${p.name} â‚©${fmt(p.amount)}`).join(' / ');
    return `<tr>
      <td>${e.date}</td>
      <td>${catLabel(e.category)}</td>
      <td>${e.description}</td>
      <td>${ps}</td>
      <td style="text-align:right;font-weight:700;">â‚©${fmt(e.totalAmount)}</td>
    </tr>`;
  }).join('');

  document.getElementById('print-area').innerHTML = `
    <div class="print-page">
      <div class="print-header-bar">
        <div class="print-main-title">ğŸ² 2026 ë³´ë™ë³´ë™ ê°“ìƒì§€ì›ê¸ˆ ì‹ ì²­ì„œ</div>
        <div class="print-sub">ë³´ë“œê²Œì„ ì§€ì›ê¸ˆ í™˜ê¸‰ ì‹ ì²­</div>
      </div>
      <div class="print-stamp-row">
        <div class="print-stamp">
          <div style="font-size:8pt;color:#888;">ì‹ ì²­ì¼</div>
          <div class="stamp-label">${fmtDate(app.createdAt)}</div>
          <div style="font-size:7pt;color:#888;">${app.id}</div>
        </div>
      </div>

      <div class="print-section">
        <div class="print-section-title">â–¶ ì‹ ì²­ ë‚´ì—­ (ìƒë‹¨)</div>
        <table class="print-table">
          <thead><tr>
            <th>ì´ìš©ì¼ì</th><th>êµ¬ë¶„</th><th>ì´ìš©ë‚´ìš©</th><th>ì´ìš©ìëª… (ì‹ ì²­ê¸ˆì•¡)</th><th>ì‹ ì²­ê¸ˆì•¡</th>
          </tr></thead>
          <tbody>${topRows}</tbody>
          <tfoot><tr style="background:#EFF6FF;">
            <td colspan="4" style="text-align:right;font-weight:700;padding:8px 10px;border:1px solid #93C5FD;">í•© ê³„</td>
            <td style="text-align:right;font-weight:900;font-size:12pt;padding:8px 10px;border:1px solid #93C5FD;">â‚©${fmt(app.totalAmount)}</td>
          </tr></tfoot>
        </table>
      </div>

      <div class="print-total-box">
        <span class="print-total-label">ì´ ì‹ ì²­ê¸ˆì•¡</span>
        <span class="print-total-amount">â‚©${fmt(app.totalAmount)}</span>
      </div>

      <div class="print-section">
        <div class="print-section-title">â–¶ ì…ê¸ˆ ì •ë³´ (í•˜ë‹¨)</div>
        <div class="print-bank-box">
          <div class="print-bank-row"><span class="print-bank-key">ì€í–‰ëª…</span><span>${app.bankName}</span></div>
          <div class="print-bank-row"><span class="print-bank-key">ê³„ì¢Œë²ˆí˜¸</span><span style="font-size:12pt;font-weight:700;">${app.accountNum}</span></div>
          <div class="print-bank-row"><span class="print-bank-key">ì˜ˆê¸ˆì£¼</span><span>${app.accountName}</span></div>
          <div class="print-bank-row" style="margin-top:6px;padding-top:6px;border-top:1px solid #93C5FD;">
            <span class="print-bank-key">ì…ê¸ˆí•„ìš”ì•¡</span>
            <span style="font-size:14pt;font-weight:900;color:#1e3a8a;">â‚©${fmt(app.totalAmount)}</span>
          </div>
        </div>
      </div>

      ${app.note ? `<div style="margin:10px 0;font-size:9pt;color:#555;">ğŸ“ ë¹„ê³ : ${app.note}</div>` : ''}
      ${app.adminNote ? `<div style="margin:6px 0;font-size:9pt;color:#1e40af;">ğŸ’¬ ê´€ë¦¬ì ë©”ëª¨: ${app.adminNote}</div>` : ''}

      <div class="print-footer">
        <span>2026 ë³´ë™ë³´ë™ ê°“ìƒì§€ì›ê¸ˆ ì§€ì›ì‚¬ì—…</span>
        <div class="print-sig">
          <div style="font-size:8pt;">ìŠ¹ì¸ì ì„œëª…</div>
          <div class="print-sig-line"></div>
          <div style="font-size:8pt;">(ì¸)</div>
        </div>
      </div>
    </div>
  `;

  closeModal('modal-print');
  DB.log(`ì¸ì‡„: ${printAppId}`, ME.id);
  setTimeout(()=>window.print(), 200);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CSV EXPORT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function exportCSV() {
  const apps = DB.apps();
  const rows = [['ì‹ ì²­ID','ì‹ ì²­ì','ì‹ ì²­ì¼','ì´ê¸ˆì•¡','ìƒíƒœ','ì€í–‰','ê³„ì¢Œ','ì˜ˆê¸ˆì£¼','í•­ëª©ìˆ˜','ë¹„ê³ ']];
  apps.forEach(a=>{
    rows.push([a.id,a.applicantName,fmtDate(a.createdAt),a.totalAmount,a.status,a.bankName,a.accountNum,a.accountName,(a.entries||[]).length,a.note||'']);
  });
  const csv = rows.map(r=>r.map(c=>`"${(c||'').toString().replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob = new Blob(['\uFEFF'+csv],{type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download=`ì‹ ì²­ì·¨í•©_${new Date().toLocaleDateString()}.csv`; a.click();
  URL.revokeObjectURL(url);
  DB.log('CSV ë‚´ë³´ë‚´ê¸°', ME.id);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function restorePending(app) {
  const users = DB.users();
  for (let e of (app.entries||[])) for (let p of e.participants) {
    const amt = parseFloat(p.amount)||0;
    if (!p.userId||amt<=0) continue;
    const ui = users.findIndex(u=>u.id===p.userId);
    if (ui!==-1) users[ui].creditPending = Math.max(0, users[ui].creditPending-amt);
  }
  DB.saveUsers(users);
}

function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.modal-overlay').forEach(m=>m.addEventListener('click',e=>{if(e.target===m)m.classList.remove('open');}));

function toast(msg, type='') {
  const c = document.getElementById('toast-container');
  const t = document.createElement('div');
  t.className = 'toast '+type;
  t.innerHTML = msg;
  c.appendChild(t);
  setTimeout(()=>{ t.style.transition='0.3s'; t.style.opacity='0'; t.style.transform='translateY(-8px)'; setTimeout(()=>t.remove(),300); },3000);
}

function fmt(n) { return Number(n||0).toLocaleString('ko-KR'); }
function now() { return new Date().toISOString(); }
function todayStr() { return new Date().toISOString().split('T')[0]; }
function fmtDate(iso, withTime=false) {
  if (!iso) return '-';
  const d = new Date(iso);
  const date = `${d.getFullYear()}.${String(d.getMonth()+1).padStart(2,'0')}.${String(d.getDate()).padStart(2,'0')}`;
  if (!withTime) return date;
  return date+' '+String(d.getHours()).padStart(2,'0')+':'+String(d.getMinutes()).padStart(2,'0');
}
function statusBadge(s) {
  const m = {pending:['ëŒ€ê¸°','badge-pending'],approved:['ìŠ¹ì¸','badge-approved'],rejected:['ë°˜ë ¤','badge-rejected'],cancelled:['ì·¨ì†Œ','badge-cancelled'],'mod-approved':['ìˆ˜ì •ìŠ¹ì¸','badge-mod-approved']};
  const [l,c] = m[s]||[s,''];
  return `<span class="badge ${c}">${l}</span>`;
}
function catLabel(c) { return {boardgame:'ğŸ² ë³´ë“œê²Œì„',escape:'ğŸ” ë°©íƒˆì¶œ',etc:'ğŸ“¦ ê¸°íƒ€'}[c]||c||'-'; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOOT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.addEventListener('DOMContentLoaded', ()=>{
  seed();
  setTimeout(()=>{
    const ls = document.getElementById('loading-screen');
    ls.style.opacity='0';
    setTimeout(()=>{
      ls.style.display='none';
      const sid = DB.get('session');
      if (sid) {
        const u = DB.users().find(u=>u.id===sid);
        if (u && u.status==='approved') { completeLogin(u); return; }
      }
      document.getElementById('login-page').style.display='block';
    },500);
  },1400);
});
</script>
</body>
</html>
